
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://pgv0117ab.safeway.com/users/wzhu004/site/index.html/merch_sql/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../supplychain_sql/">
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Merch SQL Repo - Information & Data Science Repository</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#merch-sql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Information &amp; Data Science Repository" class="md-header__button md-logo" aria-label="Information & Data Science Repository" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Information & Data Science Repository
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Merch SQL Repo
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Information &amp; Data Science Repository" class="md-nav__button md-logo" aria-label="Information & Data Science Repository" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Information & Data Science Repository
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Merch SQL Repo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Merch SQL Repo
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hourly-sales" class="md-nav__link">
    Hourly Sales
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#category-report-by-week" class="md-nav__link">
    Category Report by Week
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-sales-by-quarter-period-department-item" class="md-nav__link">
    Store Sales by Quarter Period Department Item
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp" class="md-nav__link">
    Store UPC Agp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-unieq-fiscal-periods" class="md-nav__link">
    Get Unieq Fiscal Periods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-active-items-by-vendor" class="md-nav__link">
    Get Active Items by Vendor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#periscope-forecast-by-item" class="md-nav__link">
    Periscope Forecast By Item
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#periscope-actuals-by-item-div" class="md-nav__link">
    Periscope Actuals By Item / Div
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp-sales-profit-vendor-funds" class="md-nav__link">
    Store UPC Agp Sales Profit Vendor Funds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-category-name-by-vendor" class="md-nav__link">
    Get Category Name by Vendor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp-by-category" class="md-nav__link">
    Store UPC AGP by Category
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-weight-meat-cost" class="md-nav__link">
    Random weight meat cost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#planogram-schematic-fixture" class="md-nav__link">
    Planogram Schematic Fixture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribution-voids" class="md-nav__link">
    Distribution voids
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sales-with-household-and-customer-data-penetration" class="md-nav__link">
    Sales with Household and customer data penetration
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../supplychain_sql/" class="md-nav__link">
        Supply Chain SQL Repo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../operation_sql/" class="md-nav__link">
        Operation SQL Repo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pricing_execution/" class="md-nav__link">
        Pricing Execution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../db2/" class="md-nav__link">
        DB2 Repo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../azure/" class="md-nav__link">
        Azure
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../python_code/" class="md-nav__link">
        Graph API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../decision_making_algorithm/" class="md-nav__link">
        Decision Making
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../translating_sql/" class="md-nav__link">
        SQL Intepretation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../code_snippets/" class="md-nav__link">
        Code Snippets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../useful_websites/" class="md-nav__link">
        Useful Websites
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hourly-sales" class="md-nav__link">
    Hourly Sales
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#category-report-by-week" class="md-nav__link">
    Category Report by Week
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-sales-by-quarter-period-department-item" class="md-nav__link">
    Store Sales by Quarter Period Department Item
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp" class="md-nav__link">
    Store UPC Agp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-unieq-fiscal-periods" class="md-nav__link">
    Get Unieq Fiscal Periods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-active-items-by-vendor" class="md-nav__link">
    Get Active Items by Vendor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#periscope-forecast-by-item" class="md-nav__link">
    Periscope Forecast By Item
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#periscope-actuals-by-item-div" class="md-nav__link">
    Periscope Actuals By Item / Div
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp-sales-profit-vendor-funds" class="md-nav__link">
    Store UPC Agp Sales Profit Vendor Funds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-category-name-by-vendor" class="md-nav__link">
    Get Category Name by Vendor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-upc-agp-by-category" class="md-nav__link">
    Store UPC AGP by Category
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-weight-meat-cost" class="md-nav__link">
    Random weight meat cost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#planogram-schematic-fixture" class="md-nav__link">
    Planogram Schematic Fixture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribution-voids" class="md-nav__link">
    Distribution voids
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sales-with-household-and-customer-data-penetration" class="md-nav__link">
    Sales with Household and customer data penetration
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="merch-sql">Merch SQL<a class="headerlink" href="#merch-sql" title="Permanent link">&para;</a></h1>
<h2 id="hourly-sales">Hourly Sales<a class="headerlink" href="#hourly-sales" title="Permanent link">&para;</a></h2>
<!-- === "Hourly Sales" -->

<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="n">TRY_TO_NUMBER</span><span class="p">(</span><span class="n">LUS</span><span class="p">.</span><span class="n">DISTRICT_CD</span><span class="p">)::</span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRICT_ID</span>
<span class="p">,</span><span class="n">HDR</span><span class="p">.</span><span class="n">STORE_ID</span>
<span class="p">,</span><span class="k">REF</span><span class="p">.</span><span class="n">RTL_DEPT_ID</span>
<span class="p">,</span><span class="n">LDAY</span><span class="p">.</span><span class="n">DAY_OF_FISCAL_WEEK_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">WEEKDAY_NBR</span>
<span class="p">,</span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_DTE</span>
<span class="p">,</span><span class="k">EXTRACT</span><span class="p">(</span><span class="n">HOUR</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_TM</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TXN_HOUR</span>
<span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">ITM</span><span class="p">.</span><span class="n">NET_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES</span>
<span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_ID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BASKETS</span>

<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_EDW_VIEWS</span><span class="p">.</span><span class="n">TXN_HDR</span><span class="w"> </span><span class="n">HDR</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_EDW_VIEWS</span><span class="p">.</span><span class="n">TXN_ITEM</span><span class="w"> </span><span class="n">ITM</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_DTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ITM</span><span class="p">.</span><span class="n">TXN_DT</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ITM</span><span class="p">.</span><span class="n">TXN_ID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ITM</span><span class="p">.</span><span class="n">DTL_SUBTYPE_ID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_DTE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;06/20/2021&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;09/11/2021&#39;</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_RETAIL_STORE</span><span class="w"> </span><span class="n">LUS</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">TRY_TO_NUMBER</span><span class="p">(</span><span class="n">LUS</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="p">)::</span><span class="nb">INTEGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">STORE_ID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">LUS</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;19&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">LUS</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;1542&#39;</span><span class="p">,</span><span class="s1">&#39;4904&#39;</span><span class="p">)</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D0_FISCAL_DAY</span><span class="w"> </span><span class="n">LDAY</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">LDAY</span><span class="p">.</span><span class="n">CALENDAR_DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">TXN_DTE</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_EDW_VIEWS</span><span class="p">.</span><span class="n">DEPT_XREF</span><span class="w"> </span><span class="k">REF</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">REF</span><span class="p">.</span><span class="n">TLOG_DEPT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ITM</span><span class="p">.</span><span class="n">STORE_DEPT_ID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">HDR</span><span class="p">.</span><span class="n">STORE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">REF</span><span class="p">.</span><span class="n">STORE_ID</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">;</span>
</code></pre></div>
<h2 id="category-report-by-week">Category Report by Week<a class="headerlink" href="#category-report-by-week" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="n">FISCAL_WEEK_ID</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">week_id</span><span class="p">,</span>
<span class="n">FISCAL_PERIOD_ID</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PERIOD_ID</span><span class="p">,</span>
<span class="n">FISCAL_QUARTER_ID</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">QUARTER_ID</span><span class="p">,</span>
<span class="n">Division_nm</span><span class="p">,</span>
<span class="n">DISTRICT_ID</span><span class="p">,</span>
<span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">group_nm</span><span class="p">,</span>
<span class="n">category_id</span><span class="p">,</span>
<span class="n">category_nm</span><span class="p">,</span>
<span class="n">class_id</span><span class="p">,</span>
<span class="n">class_nm</span><span class="p">,</span>
<span class="n">subclass_id</span><span class="p">,</span>
<span class="n">subclass_nm</span><span class="p">,</span>
<span class="n">MANUF_TYPE_CD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OWN_BRANDS</span><span class="p">,</span>
<span class="n">CORP_ITEM_CD</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CIC_Code</span><span class="p">,</span>
<span class="n">upc_dsc</span><span class="p">,</span>
<span class="n">upc_nbr</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_NET_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_NET_AMT_TY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">ITEM_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ITEM_QTY_TY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">COST_OF_GOODS_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COST_OF_GOODS_AMT_TY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">MEASURED_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MEASURED_QTY_TY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">AGP_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXTENDED_AMT_TY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_NET_AMT_LY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ITEM_QTY_LY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COST_OF_GOODS_AMT_LY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MEASURED_QTY_LY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXTENDED_AMT_LY</span>


<span class="k">from</span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;STORE_UPC_AGP&quot;</span><span class="w"> </span><span class="n">AGP</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;D1_RETAIL_STORE&quot;</span><span class="w"> </span><span class="n">LUS</span>
<span class="k">on</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LUS</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="c1">--AND lus.DIVISION_ID = 5</span>
<span class="k">and</span><span class="w"> </span><span class="n">CLOSE_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">current_date</span>
<span class="k">and</span><span class="w"> </span><span class="n">OPEN_DT</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">current_date</span><span class="p">)</span><span class="o">-</span><span class="mi">365</span>
<span class="k">and</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="w"> </span><span class="o">-</span><span class="mi">181</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="c1">--full timeframe</span>
<span class="c1">--and agp.transaction_dt = &#39;04/05/2022&#39;</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_EDW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;LU_UPC&quot;</span><span class="w"> </span><span class="n">UPC</span>
<span class="k">on</span><span class="w"> </span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPC_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">9900</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">9902</span><span class="p">,</span><span class="mi">9931</span><span class="p">,</span><span class="mi">9932</span><span class="p">,</span><span class="mi">9933</span><span class="p">,</span><span class="mi">9934</span><span class="p">,</span><span class="mi">9935</span><span class="p">,</span><span class="mi">9937</span><span class="p">,</span><span class="mi">9938</span><span class="p">,</span><span class="mi">9939</span><span class="p">,</span><span class="mi">9959</span><span class="p">,</span><span class="mi">9961</span><span class="p">,</span><span class="mi">9962</span><span class="p">,</span><span class="mi">9963</span><span class="p">,</span><span class="mi">9964</span><span class="p">,</span><span class="mi">9966</span><span class="p">,</span><span class="mi">9967</span><span class="p">,</span><span class="mi">9968</span><span class="p">,</span><span class="mi">9969</span><span class="p">,</span><span class="mi">9972</span><span class="p">,</span><span class="mi">9973</span><span class="p">,</span><span class="mi">9974</span><span class="p">,</span><span class="mi">9975</span><span class="p">,</span><span class="mi">9976</span><span class="p">,</span><span class="mi">9977</span><span class="p">,</span><span class="mi">9978</span><span class="p">,</span><span class="mi">9979</span><span class="p">,</span><span class="mi">9985</span><span class="p">,</span><span class="mi">9986</span><span class="p">,</span><span class="mi">9987</span><span class="p">,</span><span class="mi">9988</span><span class="p">,</span><span class="mi">9989</span><span class="p">,</span><span class="mi">9990</span><span class="p">,</span><span class="mi">9991</span><span class="p">,</span><span class="mi">9992</span><span class="p">,</span><span class="mi">9993</span><span class="p">,</span><span class="mi">9994</span><span class="p">,</span><span class="mi">9995</span><span class="p">,</span><span class="mi">9996</span><span class="p">,</span><span class="mi">9997</span><span class="p">,</span><span class="mi">9998</span><span class="p">,</span><span class="mi">9999</span><span class="p">)))</span>
<span class="k">AND</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">DEPARTMENT_ID</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">315</span><span class="p">,</span><span class="mi">329</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;D0_FISCAL_DAY&quot;</span><span class="w"> </span><span class="n">LDAY</span>
<span class="k">on</span><span class="w"> </span><span class="n">TRANSACTION_DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CALENDAR_DT</span>

<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span>

<span class="k">union</span><span class="w"> </span><span class="k">all</span>

<span class="k">select</span>
<span class="n">FISCAL_WEEK_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">week_id</span><span class="p">,</span>
<span class="n">FISCAL_PERIOD_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PERIOD_ID</span><span class="p">,</span>
<span class="n">FISCAL_QUARTER_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">QUARTER_ID</span><span class="p">,</span>
<span class="n">Division_nm</span><span class="p">,</span>
<span class="n">DISTRICT_ID</span><span class="p">,</span>
<span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">group_nm</span><span class="p">,</span>
<span class="n">category_id</span><span class="p">,</span>
<span class="n">category_nm</span><span class="p">,</span>
<span class="n">class_id</span><span class="p">,</span>
<span class="n">class_nm</span><span class="p">,</span>
<span class="n">subclass_id</span><span class="p">,</span>
<span class="n">subclass_nm</span><span class="p">,</span>
<span class="n">manuf_type_cd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">OWN_BRANDS</span><span class="p">,</span>
<span class="n">CORP_ITEM_CD</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CIC_Code</span><span class="p">,</span>
<span class="n">upc_dsc</span><span class="p">,</span>
<span class="n">upc_nbr</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_NET_AMT_TY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ITEM_QTY_TY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COST_OF_GOODS_AMT_TY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MEASURED_QTY_TY</span><span class="p">,</span>
<span class="k">cast</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">decimal</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXTENDED_AMT_TY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_NET_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_NET_AMT_LY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">ITEM_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ITEM_QTY_LY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">COST_OF_GOODS_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COST_OF_GOODS_AMT_LY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">MEASURED_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MEASURED_QTY_LY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">AGP_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXTENDED_AMT_LY</span>


<span class="k">from</span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;STORE_UPC_AGP&quot;</span><span class="w"> </span><span class="n">AGP</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;D1_RETAIL_STORE&quot;</span><span class="w"> </span><span class="n">LUS</span>
<span class="k">on</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LUS</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>

<span class="k">and</span><span class="w"> </span><span class="n">CLOSE_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">current_date</span>
<span class="k">and</span><span class="w"> </span><span class="n">OPEN_DT</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">current_date</span><span class="p">)</span><span class="o">-</span><span class="mi">365</span>
<span class="k">and</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">TO_DATE</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">)</span><span class="o">-</span><span class="mi">545</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TO_DATE</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">)</span><span class="o">-</span><span class="mi">365</span><span class="w"> </span><span class="c1">--full timeframe</span>
<span class="c1">--and agp.transaction_dt = to_date(&#39;2022-04-05&#39;)-364</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_EDW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;LU_UPC&quot;</span><span class="w"> </span><span class="n">UPC</span>
<span class="k">on</span><span class="w"> </span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPC_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">9900</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">9902</span><span class="p">,</span><span class="mi">9931</span><span class="p">,</span><span class="mi">9932</span><span class="p">,</span><span class="mi">9933</span><span class="p">,</span><span class="mi">9934</span><span class="p">,</span><span class="mi">9935</span><span class="p">,</span><span class="mi">9937</span><span class="p">,</span><span class="mi">9938</span><span class="p">,</span><span class="mi">9939</span><span class="p">,</span><span class="mi">9959</span><span class="p">,</span><span class="mi">9961</span><span class="p">,</span><span class="mi">9962</span><span class="p">,</span><span class="mi">9963</span><span class="p">,</span><span class="mi">9964</span><span class="p">,</span><span class="mi">9966</span><span class="p">,</span><span class="mi">9967</span><span class="p">,</span><span class="mi">9968</span><span class="p">,</span><span class="mi">9969</span><span class="p">,</span><span class="mi">9972</span><span class="p">,</span><span class="mi">9973</span><span class="p">,</span><span class="mi">9974</span><span class="p">,</span><span class="mi">9975</span><span class="p">,</span><span class="mi">9976</span><span class="p">,</span><span class="mi">9977</span><span class="p">,</span><span class="mi">9978</span><span class="p">,</span><span class="mi">9979</span><span class="p">,</span><span class="mi">9985</span><span class="p">,</span><span class="mi">9986</span><span class="p">,</span><span class="mi">9987</span><span class="p">,</span><span class="mi">9988</span><span class="p">,</span><span class="mi">9989</span><span class="p">,</span><span class="mi">9990</span><span class="p">,</span><span class="mi">9991</span><span class="p">,</span><span class="mi">9992</span><span class="p">,</span><span class="mi">9993</span><span class="p">,</span><span class="mi">9994</span><span class="p">,</span><span class="mi">9995</span><span class="p">,</span><span class="mi">9996</span><span class="p">,</span><span class="mi">9997</span><span class="p">,</span><span class="mi">9998</span><span class="p">,</span><span class="mi">9999</span><span class="p">)))</span>
<span class="k">AND</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">DEPARTMENT_ID</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">315</span><span class="p">,</span><span class="mi">329</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="k">join</span><span class="w"> </span><span class="ss">&quot;EDM_VIEWS_PRD&quot;</span><span class="p">.</span><span class="ss">&quot;DW_VIEWS&quot;</span><span class="p">.</span><span class="ss">&quot;D0_FISCAL_DAY&quot;</span><span class="w"> </span><span class="n">LDAY</span>
<span class="k">on</span><span class="w"> </span><span class="n">TRANSACTION_DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CALENDAR_DT</span>

<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span>
</code></pre></div>
<h2 id="store-sales-by-quarter-period-department-item">Store Sales by Quarter Period Department Item<a class="headerlink" href="#store-sales-by-quarter-period-department-item" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="n">PD</span><span class="p">.</span><span class="n">FISCAL_PERIOD_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">PERIOD</span><span class="p">,</span><span class="w">         </span><span class="c1">--LU.PERIOD_ID as PERIOD,</span>
<span class="n">PD</span><span class="p">.</span><span class="n">FISCAL_QUARTER_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">QUARTER</span><span class="p">,</span><span class="w">                  </span><span class="c1">--LU.QUARTER_ID as QUARTER,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">DISTRICT_CD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRICT</span><span class="p">,</span><span class="w">            </span><span class="c1">--STR.DISTRICT_CD AS DISTRICT,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">STORE</span><span class="p">,</span><span class="w">            </span><span class="c1">--STR.STORE_ID AS STORE,</span>
<span class="n">ROG</span><span class="p">.</span><span class="n">DEPARTMENT_ID</span><span class="w"> </span><span class="o">||</span><span class="s1">&#39; &#39;</span><span class="o">||</span><span class="n">ROG</span><span class="p">.</span><span class="n">SMIC_GROUP_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DEPARTMENT</span><span class="p">,</span><span class="w">         </span><span class="c1">--ITM.DEPARTMENT_ID ||&#39; &#39;||ITM.DEPARTMENT_NM AS DEPARTMENT,</span>
<span class="n">ROG</span><span class="p">.</span><span class="n">CATEGORY_ID</span><span class="o">||</span><span class="s1">&#39; &#39;</span><span class="o">||</span><span class="n">ROG</span><span class="p">.</span><span class="n">SMIC_CATEGORY_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">,</span><span class="w">            </span><span class="c1">--ITM.CATEGORY_ID ||&#39; &#39;|| ITM.CATEGORY_NM AS CATEGORY,</span>
<span class="n">ROG</span><span class="p">.</span><span class="n">CLASS_ID</span><span class="o">||</span><span class="s1">&#39; &#39;</span><span class="o">||</span><span class="n">ROG</span><span class="p">.</span><span class="n">SMIC_CLASS_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">CLASS</span><span class="p">,</span><span class="w">            </span><span class="c1">--ITM.CLASS_ID ||&#39; &#39;|| ITM.CLASS_NM AS CLASS,</span>
<span class="n">TXN</span><span class="p">.</span><span class="n">UPC_ID</span><span class="o">||</span><span class="s1">&#39; &#39;</span><span class="o">||</span><span class="n">CI</span><span class="p">.</span><span class="n">ITEM_DSC</span><span class="o">||</span><span class="s1">&#39; - CIC &#39;</span><span class="o">||</span><span class="n">CI</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPTION</span><span class="p">,</span><span class="w">            </span><span class="c1">--ITM.UPC_ID ||&#39; &#39;|| ITM.UPC_DSC ||&#39; - CIC &#39;||ITM.CORP_ITEM_CD AS DESCRIPTION,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">TXN</span><span class="p">.</span><span class="n">NET_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES_TY</span><span class="w">            </span><span class="c1">--SUM(TXN.NET_AMT) AS SALES_TY</span>

<span class="k">FROM</span><span class="w"> </span><span class="n">DW_EDW_VIEWS</span><span class="p">.</span><span class="n">TXN_FACTS</span><span class="w"> </span><span class="n">TXN</span><span class="w">             </span><span class="c1">--FROM DW_DSS.TXN_FACTS TXN</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">RETAIL_ORDER_GROUP_UPC_EXTENDED</span><span class="w"> </span><span class="n">ROG</span><span class="w">            </span><span class="c1">--JOIN DW_DSS.LU_UPC ITM</span>
<span class="k">ON</span><span class="w"> </span><span class="n">TXN</span><span class="p">.</span><span class="n">UPC_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w">            </span><span class="c1">--ON TXN.UPC_ID = ITM.UPC_ID</span>

<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CORPORATE_ITEM</span><span class="w"> </span><span class="n">CI</span>
<span class="w">    </span><span class="k">ON</span><span class="w">  </span><span class="n">TXN</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CI</span><span class="p">.</span><span class="n">CORPORATION_ID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">COMMON_RETAIL_CD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CI</span><span class="p">.</span><span class="n">COMMON_RETAIL_CD</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">CI</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">PREFERRED_CORPORATE_ITEM_CD</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_RETAIL_STORE</span><span class="w"> </span><span class="n">STR</span><span class="w">            </span><span class="c1">--JOIN DW_DSS.LU_STORE_FINANCE_OM STR</span>
<span class="k">ON</span><span class="w"> </span><span class="n">TXN</span><span class="p">.</span><span class="n">STORE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w">            </span><span class="c1">--ON TXN.STORE_ID = STR.STORE_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w">                     </span><span class="c1">-- had to join ROG_ID to prevent overstated numbers</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CALENDAR</span><span class="w"> </span><span class="n">CAL</span><span class="w">            </span><span class="c1">--JOIN DW_DSS.LU_DAY_MERGE LU</span>
<span class="k">ON</span><span class="w"> </span><span class="n">TXN</span><span class="p">.</span><span class="n">TXN_DTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">CALENDAR_DT</span><span class="w">            </span><span class="c1">--ON TXN.txn_dte = LU.D_DATE</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">FISCAL_PERIOD</span><span class="w"> </span><span class="n">PD</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">FISCAL_PERIOD_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PD</span><span class="p">.</span><span class="n">FISCAL_PERIOD_NBR</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">FISCAL_YEAR_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PD</span><span class="p">.</span><span class="n">FISCAL_YEAR_NBR</span><span class="w"> </span><span class="c1">-- ADDING THIS JOIN IN EDM REDUCES THE OVERSTATEMENT BY HALF VS NOT INCLUDING</span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">CALENDAR_DT</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;04/01/2022&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="o">-</span><span class="mi">1</span><span class="w">            </span><span class="c1">--WHERE TXN.TXN_DTE BETWEEN &#39;02/28/2021&#39; and CURRENT_DATE-1</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;32&#39;</span><span class="w">            </span><span class="c1">--AND STR.OP_AREA_FINANCE_CD = 32 --DIVISION</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;001&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%JEWEL%&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">DEPARTMENT_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">306</span><span class="p">,</span><span class="mi">309</span><span class="p">)</span><span class="w">            </span><span class="c1">--AND ITM.DEPARTMENT_ID IN (306,309) --DEPARTMENT</span>

<span class="k">AND</span><span class="w"> </span><span class="n">ROG</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">PD</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">PD</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CAL</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CI</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CI</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">;</span>
</code></pre></div>
<h2 id="store-upc-agp">Store UPC Agp<a class="headerlink" href="#store-upc-agp" title="Permanent link">&para;</a></h2>
<!-- === "Store UPC Agp" -->

<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="s1">&#39;SUA EDW&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SRC</span>
<span class="p">,</span><span class="n">STORE_ID</span>
<span class="p">,</span><span class="n">UPC_ID</span>
<span class="p">,</span><span class="n">DAY_DT</span>
<span class="p">,</span><span class="n">SUM_ITEM_QTY</span>
<span class="p">,</span><span class="n">SUM_NET_AMT</span>
<span class="p">,</span><span class="w"> </span><span class="n">AGP_EXT_AMT</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_EDW_VIEWS</span><span class="p">.</span><span class="n">store_upc_agp</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">STORE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1467</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC_ID</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">954201519</span>
<span class="k">AND</span><span class="w"> </span><span class="n">DAY_DT</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2021-12-01&#39;</span><span class="p">::</span><span class="nb">DATE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2021-12-28&#39;</span><span class="p">::</span><span class="nb">DATE</span>
<span class="k">UNION</span>
<span class="c1">-- EDM Query:</span>
<span class="k">SELECT</span>
<span class="s1">&#39;EDM SUA&#39;</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">SRC</span>
<span class="p">,</span><span class="n">FACILITY_NBR</span><span class="w">       </span><span class="k">AS</span><span class="w"> </span><span class="n">STORE_ID</span>
<span class="p">,</span><span class="n">UPC_NBR</span><span class="w">            </span><span class="k">AS</span><span class="w"> </span><span class="n">UPC_ID</span>
<span class="p">,</span><span class="n">TRANSACTION_DT</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">DAY_DT</span>
<span class="p">,</span><span class="n">ITEM_QTY</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">SUM_ITEM_QTY</span>
<span class="p">,</span><span class="n">NET_AMT</span><span class="w">            </span><span class="k">AS</span><span class="w"> </span><span class="n">SUM_NET_AMT</span>
<span class="p">,</span><span class="n">AGP_EXTENDED_AMT</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXT_AMT</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_prd</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">store_upc_agp</span><span class="w"> </span><span class="n">agp</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_prd</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">retail_store</span><span class="w"> </span><span class="n">str</span>
<span class="k">ON</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">TRANSACTION_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2022-09-08&#39;</span><span class="p">::</span><span class="nb">DATE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1000</span>
<span class="k">AND</span><span class="w"> </span><span class="n">FACILITY_NBR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1467</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC_NBR</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">954201519</span>
<span class="k">AND</span><span class="w"> </span><span class="n">TRANSACTION_DT</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2021-12-01&#39;</span><span class="p">::</span><span class="nb">DATE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2021-12-28&#39;</span><span class="p">::</span><span class="nb">DATE</span><span class="p">;</span>
</code></pre></div>
<h2 id="get-unieq-fiscal-periods">Get Unieq Fiscal Periods<a class="headerlink" href="#get-unieq-fiscal-periods" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">as</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">  </span><span class="n">cal</span><span class="p">.</span><span class="n">calendar_dt</span><span class="w">                                 </span><span class="k">AS</span><span class="w"> </span><span class="n">d_date</span><span class="p">,</span>
<span class="w">  </span><span class="n">fw</span><span class="p">.</span><span class="n">fiscal_period_id</span><span class="w">                             </span><span class="k">AS</span><span class="w"> </span><span class="n">period_id</span>
<span class="w">  </span><span class="k">FROM</span><span class="w">        </span><span class="n">edm_views_prd</span><span class="p">.</span><span class="n">dw_views</span><span class="p">.</span><span class="n">calendar</span><span class="w">                 </span><span class="k">AS</span><span class="w"> </span><span class="n">cal</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">edm_views_prd</span><span class="p">.</span><span class="n">dw_views</span><span class="p">.</span><span class="n">d0_fiscal_week</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">fw</span>
<span class="w">        </span><span class="k">ON</span><span class="w">  </span><span class="n">cal</span><span class="p">.</span><span class="n">fiscal_year_nbr</span><span class="w">                             </span><span class="o">=</span><span class="w">  </span><span class="n">fw</span><span class="p">.</span><span class="n">fiscal_year_nbr</span>
<span class="w">       </span><span class="k">AND</span><span class="w">  </span><span class="n">cal</span><span class="p">.</span><span class="n">fiscal_week_nbr</span><span class="w">                             </span><span class="o">=</span><span class="w">  </span><span class="n">fw</span><span class="p">.</span><span class="n">fiscal_week_nbr</span>
<span class="k">WHERE</span><span class="w">       </span><span class="n">cal</span><span class="p">.</span><span class="n">dw_logical_delete_ind</span><span class="w">                       </span><span class="o">=</span><span class="w">  </span><span class="k">False</span>
<span class="w">  </span><span class="k">AND</span><span class="w">       </span><span class="n">cal</span><span class="p">.</span><span class="n">dw_current_version_ind</span><span class="w">                      </span><span class="o">=</span><span class="w">  </span><span class="k">True</span>
<span class="p">),</span>
<span class="n">lu_period_merge</span><span class="w"> </span><span class="k">as</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">fiscal_period_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">period_id</span>
<span class="w">  </span><span class="p">,</span><span class="n">fiscal_period_end_dt</span><span class="w">        </span><span class="k">AS</span><span class="w"> </span><span class="n">end_dt</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D0_FISCAL_PERIOD</span>
<span class="p">)</span>
<span class="k">select</span><span class="w"> </span><span class="n">period_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">lu_period_merge</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">period_id</span><span class="w"> </span><span class="k">between</span>
<span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">period_id</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">lu_day_merge</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">d_date</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">end_date</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">where</span>
<span class="w">    </span><span class="n">period_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">period_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">end_period</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">lu_period_merge</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">end_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">end_dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">60</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">and</span>
<span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">period_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">where</span>
<span class="w">    </span><span class="n">period_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">period_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">end_period</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">lu_period_merge</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">end_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">end_dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">desc</span>
</code></pre></div>
<h2 id="get-active-items-by-vendor">Get Active Items by Vendor<a class="headerlink" href="#get-active-items-by-vendor" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="n">cat_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="mi">5701</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">vendor_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="mi">1026</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">luc</span><span class="p">.</span><span class="n">Item_Status_Cd</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">corp_status_cd</span>
<span class="p">,</span><span class="w"> </span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Category_Cd</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cat_id</span>
<span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">Vendor_UPC_Id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">luc</span><span class="p">.</span><span class="n">Display_Item_Ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span>
<span class="w">     </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">SCI</span><span class="p">.</span><span class="n">ship_unit_pack_type_cd</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">SCI</span><span class="p">.</span><span class="n">ship_unit_pack_type_cd</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Vendor_UPC_Id</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w">  </span><span class="n">upc_id</span>
<span class="p">,</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">item_dsc</span><span class="w"> </span><span class="k">AS</span><span class="w">  </span><span class="n">cic_desc</span><span class="w">          </span>
<span class="p">,</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">AS</span><span class="w">  </span><span class="n">corp_item_cd</span>
<span class="p">,</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Ship_Unit_Pack_Qty</span><span class="w"> </span><span class="k">AS</span><span class="w">  </span><span class="n">pack_qty</span>
<span class="p">,</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">SHELF_UNIT_SIZE_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">item_size</span>
<span class="p">,</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span><span class="o">*</span><span class="mi">10000</span><span class="o">+</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_Category_Cd</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_Class_Cd</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">class_id</span>
<span class="p">,</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_Class_Dsc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">class_name</span>
<span class="p">,</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">VENDOR_UNIT_COST_AMT</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">vend_unit_cost</span>
<span class="p">,</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">Vendor_Id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">vendor_nbr</span><span class="w">     </span>
<span class="p">,</span><span class="w"> </span><span class="n">CIGI</span><span class="p">.</span><span class="n">common_item_group_cd</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cig</span>
<span class="p">,</span><span class="w"> </span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Category_Dsc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cat_name</span>
<span class="p">,</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Ship_Unit_Pack_Qty</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">min_order_qty</span>
<span class="p">,</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Buyer_Nbr</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">buyer_nbr</span>
<span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Ship_Unit_Pack_Qty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">-- eaches</span>
<span class="w">     </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">-- cases</span>
<span class="w">   </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">retail_order</span>

<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Retail_Order_Group_Corporate_item</span><span class="w"> </span><span class="n">wir</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">WAREHOUSE</span><span class="w"> </span><span class="n">luw</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">luw</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">corporation_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span>
<span class="k">AND</span><span class="w"> </span><span class="n">luw</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">luw</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">WIR</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">WIR</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CORPORATE_ITEM_UPC_ROG_REFERENCE</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">Corporate_Item_Integration_Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">Corporate_Item_Integration_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">Rog_Id</span>
<span class="k">AND</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">to_date</span><span class="p">(</span><span class="n">cur</span><span class="p">.</span><span class="n">DW_FIRST_EFFECTIVE_DT</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">to_date</span><span class="p">(</span><span class="n">cur</span><span class="p">.</span><span class="n">DW_LAST_EFFECTIVE_DT</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Common_Item_Group_Item</span><span class="w"> </span><span class="n">CIGI</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CIGI</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CIGI</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CIGI</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Corporate_Item</span><span class="w"> </span><span class="n">luc</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Corporate_Item_Integration_Id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">Corporate_Item_Integration_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">corporation_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">AND</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">SMIC_Category</span><span class="w"> </span><span class="n">SCAT</span>
<span class="k">ON</span><span class="w"> </span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SCAT</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SCAT</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">SCAT</span><span class="p">.</span><span class="n">SMIC_Category_Cd</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="mi">5705</span><span class="w"> </span><span class="c1">-- category id</span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Supply_Chain_Item</span><span class="w"> </span><span class="n">SCI</span>
<span class="k">ON</span><span class="w"> </span><span class="n">SCI</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SCI</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SCI</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Vendor_item</span><span class="w"> </span><span class="n">VITEM</span>
<span class="k">ON</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span><span class="o">=</span><span class="n">SCI</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">SMIC_Class</span><span class="w"> </span><span class="n">SLS</span>
<span class="k">ON</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">SMIC_Group_Cd</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_CATEGORY_CD</span><span class="o">=</span><span class="w"> </span><span class="n">LUC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_CD</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">SMIC_CLASS_CD</span><span class="o">=</span><span class="w"> </span><span class="n">LUC</span><span class="p">.</span><span class="n">SMIC_CLASS_CD</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">SLS</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Supply_Chain_Item</span><span class="w"> </span><span class="n">scm</span>
<span class="k">ON</span><span class="w"> </span><span class="n">scm</span><span class="p">.</span><span class="n">Warehouse_Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">scm</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">scm</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Vendor_Item</span><span class="w"> </span><span class="n">vit</span><span class="w"> </span>
<span class="k">on</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scm</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>

<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Corporate_Item</span><span class="w"> </span><span class="n">ci</span>
<span class="k">on</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>


<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">WAREHOUSE_COST</span><span class="w">  </span><span class="n">wco</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wir</span><span class="p">.</span><span class="n">Corporate_Item_Integration_id</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">VENDOR_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vit</span><span class="p">.</span><span class="n">Vendor_Id</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">try_to_number</span><span class="p">(</span><span class="n">vit</span><span class="p">.</span><span class="n">Vendor_Id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1026</span><span class="w"> </span><span class="c1">-- vendor id</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">ACTIVE_VENDOR_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">VENDOR_UNIT_COST_AMT</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">wco</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>

<span class="w"> </span><span class="k">WHERE</span><span class="w">  </span><span class="n">luc</span><span class="p">.</span><span class="n">Display_Item_Ind</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">luc</span><span class="p">.</span><span class="n">Display_Item_Ind</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">   </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">luc</span><span class="p">.</span><span class="n">Display_Item_Ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="w"> </span><span class="c1">-- displayer item</span>
<span class="w">     </span><span class="k">AND</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">Vendor_UPC_Id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">luc</span><span class="p">.</span><span class="n">Display_Item_Ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="w"> </span><span class="c1">-- displayer item</span>
<span class="w">     </span><span class="k">AND</span><span class="w"> </span><span class="n">VITEM</span><span class="p">.</span><span class="n">Vendor_UPC_Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">     </span><span class="k">AND</span><span class="w"> </span><span class="n">scm</span><span class="p">.</span><span class="n">SELECTED_ITEM_CD</span><span class="w">  </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">DESC</span>
</code></pre></div>
<h2 id="periscope-forecast-by-item">Periscope Forecast By Item<a class="headerlink" href="#periscope-forecast-by-item" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">WEEK_ID</span><span class="p">,</span>
<span class="n">CORPORATE_ITEM_CD</span><span class="p">,</span>
<span class="n">CORPORATE_ITEM_CODE_DSC</span><span class="p">,</span>
<span class="n">DIVISION_ID</span><span class="p">,</span><span class="w"> </span>
<span class="n">ROG_ID</span><span class="p">,</span>
<span class="n">CASE_SIZE_NBR</span><span class="p">,</span>
<span class="n">primary_tactic_nm</span><span class="p">,</span><span class="w"> </span><span class="n">PRIMARY_TACTIC_DSC</span><span class="p">,</span>
<span class="w">    </span><span class="n">COMMON_ITEM_GROUP_ID</span><span class="p">,</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">VENDOR_PARENT_NM</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">vend_nm</span><span class="p">,</span><span class="w"> </span><span class="n">vehicle_type_txt</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">forecast_unit_nbr</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">units</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">TOTAL_MARKDOWN_FORECAST_AMT</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mkdn</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">TOTAL_MARGIN_FORECAST_EXPENSE_AMT</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">agp</span><span class="p">,</span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">total_sale_forecast_amt</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales</span>
<span class="k">From</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PROMO_ROLLUP_RPT</span><span class="w"> </span><span class="n">rpt</span>
<span class="k">Where</span><span class="w"> </span>
<span class="n">promotion_week_start_dt</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">current_date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">57500015</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CASE_SIZE_NBR</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span>
</code></pre></div>
<h2 id="periscope-actuals-by-item-div">Periscope Actuals By Item / Div<a class="headerlink" href="#periscope-actuals-by-item-div" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">DIV</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
<span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DENVER&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;05&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;INTERMOUNTAIN&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="s1">&#39;30&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;JEWEL&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;32&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;MID-ATLANTIC&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;34&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;NOR CALIFORNIA&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;25&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;PORTLAND&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;19&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;SEATTLE&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;27&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;SHAWS&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;33&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;SO CALIFORNIA&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;29&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;SOUTHERN&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;20&#39;</span>
<span class="k">WHEN</span><span class="w"> </span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;SOUTHWEST&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;17&#39;</span><span class="w"> </span>
<span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DIVISION_ID</span><span class="p">,</span><span class="w"> </span>
<span class="n">DIVISION_NM</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PROMO_PERF_RPT</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="k">SELECT</span><span class="w">  </span>
<span class="w">    </span><span class="n">QUARTER_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">FISCAL_QUARTER_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">FISCAL_PERIOD_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">WEEK_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">PROMOTION_WEEK_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">YEAR_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">FISCAL_YEAR_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">BRAND_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">DEPARTMENT_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">DEPARTMENT_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">SUB_DEPARTMENT_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">CATEGORY_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">CATEGORY_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">CLASS_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">CLASS_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">DIV</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">PERF</span><span class="p">.</span><span class="n">DIVISION_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">VENDOR_PARENT_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">CORPORATE_ITEM_CD</span>
<span class="p">,</span><span class="w">   </span><span class="n">CORPORATE_ITEM_CODE_DSC</span>
<span class="p">,</span><span class="w">   </span><span class="n">COMMON_ITEM_GRP_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">OWN_BRAND_STATUS_IND</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">REG_SALE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GROSS_SALES</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_NET_SALE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NET_SALES</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_COST_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_COST</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_UNIT_SOLD_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_UNITS</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_VENDOR_FUNDING_AMT</span><span class="p">)</span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_ALLOWANCES</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_VENDOR_FUNDING_AMT</span><span class="o">-</span><span class="n">NEW_ITEM_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_ALLOWANCES_EX_NEW_ITEMS</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">COGS_SALE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COGS</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_DISCOUNT_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MARKDOWN</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">RETAIL_ALLOW_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RETAIL_ALLOWANCES</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">SHIPPING_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPING_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TRANSACTION_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TRANSACTION_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">SCAN_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SCAN_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">DSD_CASE_BILLBACK_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DSD_BB_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">NEW_ITEM_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NI_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">FLAT_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FLAT_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">ALTERNATE_SOURCE_BUYING_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ASB_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">BUYING_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BUYING_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">FREIGHT_ALLOWANCES_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FREIGHT_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TRADE_DISCOUNT_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TRADE_DISC_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">OTHER_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="n">OTHER_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">SWELL_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SWELL_ALLOW_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">UNBILLABLE_PRC_AT_COST_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UNBILLABLE_PRC_CST</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">DISTRESS_AT_COST_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRESS_CST</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP_SALE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP</span>

<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PROMO_PERF_RPT</span><span class="w"> </span><span class="n">PERF</span><span class="w"> </span>

<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DIV</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DIV</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">DIV</span><span class="p">.</span><span class="n">DIVISION_NM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PERF</span><span class="p">.</span><span class="n">DIVISION_NM</span>

<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_PROMOTION_CALENDAR_WEEK</span><span class="w"> </span><span class="n">PWK</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">PWK</span><span class="p">.</span><span class="n">PROMOTION_WEEK_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PERF</span><span class="p">.</span><span class="n">WEEK_ID</span><span class="w"> </span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">PWK</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DIV</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span>


<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">WEEK_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">202152</span><span class="p">)</span><span class="c1">--,20212,20203,20204)--(20203,20204)</span>
<span class="w">    </span><span class="c1">--where week_ID BETWEEN 202149 AND 202208</span>

<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span>
</code></pre></div>
<h2 id="store-upc-agp-sales-profit-vendor-funds">Store UPC Agp Sales Profit Vendor Funds<a class="headerlink" href="#store-upc-agp-sales-profit-vendor-funds" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">CIC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span>
<span class="n">CIURR</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">CIURR</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">CIURR</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">CIC</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">CIURR</span><span class="p">.</span><span class="n">SHELF_UNIT_SIZE_DSC</span>

<span class="k">FROM</span><span class="w">    </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CORPORATE_ITEM_UPC_ROG_REFERENCE</span><span class="w"> </span><span class="n">CIURR</span><span class="w"> </span>

<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CORPORATE_ITEM_UPC_REFERENCE</span><span class="w"> </span><span class="n">CIUR</span><span class="w"> </span>
<span class="k">ON</span><span class="w">  </span><span class="n">CIUR</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CIURR</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">CIUR</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="o">=</span><span class="w"> </span><span class="n">CIURR</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">CIUR</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="w"> </span>

<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">CORPORATE_ITEM</span><span class="w"> </span><span class="n">CIC</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">CIC</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CIURR</span><span class="p">.</span><span class="n">CORPORATE_ITEM_INTEGRATION_ID</span><span class="w"> </span>

<span class="k">WHERE</span><span class="w">   </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span>
<span class="k">AND</span><span class="w">     </span><span class="n">CIURR</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span><span class="w">  </span>
<span class="k">AND</span><span class="w">     </span><span class="n">CIURR</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="w"> </span>
<span class="k">AND</span><span class="w">     </span><span class="n">CIC</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="k">AND</span><span class="w">     </span><span class="n">CIC</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>

<span class="n">QUALIFY</span><span class="w"> </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CIURR</span><span class="p">.</span><span class="n">ROG_ID</span><span class="p">,</span><span class="w"> </span><span class="n">CIURR</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CIUR</span><span class="p">.</span><span class="n">PREFERED_CORPORATE_ITEM_SEQ_NBR</span><span class="w"> </span><span class="k">ASC</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span>

<span class="k">SELECT</span><span class="w">   </span><span class="n">PDAY</span><span class="p">.</span><span class="n">PROMOTION_WEEK_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">PWK</span><span class="p">.</span><span class="n">FISCAL_PERIOD_ID</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">PWK</span><span class="p">.</span><span class="n">FISCAL_QUARTER_ID</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="n">RST</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">RST</span><span class="p">.</span><span class="n">DIVISION_NM</span>
<span class="c1">--, RST.RETAIL_STORE_FACILITY_NBR</span>
<span class="p">,</span><span class="w">   </span><span class="n">UPC</span><span class="p">.</span><span class="n">RETAIL_DEPARTMENT_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">UPC</span><span class="p">.</span><span class="n">DEPARTMENT_NM</span>
<span class="p">,</span><span class="w">   </span><span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_DSC</span>
<span class="c1">--, RST.FACILITY_NBR</span>
<span class="c1">--, cig.COMMON_ITEM_GROUP_CD</span>
<span class="p">,</span><span class="w">   </span><span class="n">CIC</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span>
<span class="p">,</span><span class="w">   </span><span class="n">CIC</span><span class="p">.</span><span class="n">SHELF_UNIT_SIZE_DSC</span>
<span class="p">,</span><span class="w">   </span><span class="n">AGP</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="p">,</span><span class="w">   </span><span class="n">UPC</span><span class="p">.</span><span class="n">ITEM_DSC</span>

<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">GROSS_AMT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">MARKDOWN_SHORT_TERM_SPECIAL_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GROSS_SALES</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_NET_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NET_SALES</span><span class="w"> </span><span class="c1">--GROSS AMT - MARKDOWN AMT - TOTAL WODS - TOTAL PODS</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">AVERAGE_COST_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AVERAGE_COST_EXTENDED_AMT</span><span class="w">  </span><span class="c1">--VENDOR LIST COST</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">8843</span><span class="p">,</span><span class="mi">8643</span><span class="p">,</span><span class="mi">9996</span><span class="p">,</span><span class="mi">9902</span><span class="p">,</span><span class="mi">9931</span><span class="p">,</span><span class="mi">9932</span><span class="p">,</span><span class="mi">9933</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="mi">9934</span><span class="p">,</span><span class="mi">9935</span><span class="p">,</span><span class="mi">9937</span><span class="p">,</span><span class="mi">9938</span><span class="p">,</span><span class="mi">9939</span><span class="p">,</span><span class="mi">9952</span><span class="p">,</span><span class="mi">9956</span><span class="p">,</span><span class="mi">9970</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ITEM_QTY</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UNITS_SOLD</span><span class="w">    </span><span class="c1">--KPI EXCLUSION CATEGORIES TO REMOVE FROM ITEM COUNT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">RETAIL_DEPARTMENT_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;301&#39;</span><span class="p">,</span><span class="s1">&#39;303&#39;</span><span class="p">,</span><span class="s1">&#39;304&#39;</span><span class="p">,</span><span class="s1">&#39;307&#39;</span><span class="p">,</span><span class="s1">&#39;314&#39;</span><span class="p">,</span><span class="s1">&#39;317&#39;</span><span class="p">,</span><span class="s1">&#39;311&#39;</span><span class="p">,</span><span class="s1">&#39;328&#39;</span><span class="p">,</span><span class="s1">&#39;315&#39;</span><span class="p">,</span><span class="s1">&#39;316&#39;</span><span class="p">,</span><span class="s1">&#39;336&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;347&#39;</span><span class="p">,</span><span class="s1">&#39;339&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="n">MEASURED_QTY</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MEASURED_QTY</span>

<span class="c1">--Retail Allowances</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">SHIPPING_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPING_ALLOWANCE_EXTENDED_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">SCAN_ALLOWANCE_EXTENDED_AMT</span><span class="o">+</span><span class="n">AGP</span><span class="p">.</span><span class="n">REDEMPTION_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SCAN_ALLOWANCE_PERF</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">RETAIL_DSD_CASE_BILLBACK_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RETAIL_DSD_CASE_BILLBACK_ALLOWANCE_AMT</span><span class="w">   </span><span class="c1">--GENERALLY NO VALUES RETURNED</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">RETAIL_NEW_ITEM_ALLOWANCE_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RETAIL_NEW_ITEM_ALLOWANCE_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">TOTAL_FLAT_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_FLAT_ALLOWANCE_EXTENDED_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">TOTAL_BUYING_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_BUYING_ALLOWANCE_EXTENDED_AMT</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP</span><span class="p">.</span><span class="n">TOTAL_FREIGHT_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_FREIGHT_ALLOWANCE_EXTENDED_AMT</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">TOTAL_OTHER_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_OTHER_ALLOWANCE_EXTENDED_AMT</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AVERAGE_TRADE_DISCOUNT_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TRADE_DISCOUNT_ALLOWANCE_EXTENDED_AMT</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AVERAGE_SWELL_LEAKER_ALLOWANCE_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SWELL_LEAKER_ALLOWANCE_EXTENDED_AMT</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">UNBILLABLE_PRODUCT_RECOVERY_CENTER_COST_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UNBILLABLE_PRODUCT_RECOVERY_CENTER_COST_AMT</span><span class="w"> </span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">COST_OF_GOODS_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">COST_OF_GOODS_AMT</span><span class="w"> </span><span class="c1">--Computed Cost of Goods.</span>
<span class="p">,</span><span class="w">   </span><span class="k">SUM</span><span class="p">(</span><span class="n">AGP_EXTENDED_AMT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AGP_EXTENDED_AMT</span>

<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">STORE_UPC_AGP</span><span class="w"> </span><span class="n">AGP</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_RETAIL_STORE</span><span class="w"> </span><span class="n">RST</span>
<span class="k">ON</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="c1">--AND CLOSE_DT &gt; CURRENT_DATE</span>
<span class="c1">--AND OPEN_DT &lt; (CURRENT_DATE)-365</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_UPC</span><span class="w"> </span><span class="n">UPC</span>
<span class="k">ON</span><span class="w">  </span><span class="n">UPC</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="c1">--AND (UPC.SMIC_CATEGORY_ID &lt;9900 OR (UPC.SMIC_CATEGORY_ID IN (9902,9931,9932,9933,9934,9935,9937,9938,9939,9959,9961,9962,9963,9964,9966,9967,9968,9969,</span>
<span class="c1">--9972,9973,9974,9975,9976,9977,9978,9979,9985,9986,9987,9988,9989,9990,9991,9992,9993,9994,9995,9996,9997,9998,9999)))</span>
<span class="c1">--AND UPC.RETAIL_DEPARTMENT_ID NOT IN (&#39;339&#39;,&#39;304&#39;)</span>
<span class="c1">--AND UPC.CORPORATION_ID = &#39;001&#39;</span>
<span class="c1">--AND UPC.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="c1">--AND UPC.RETAIL_STATUS_IND =&#39;D&#39;</span>
<span class="c1">--AND 1=1</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;001&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">SAFEWAY_UPC_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span>

<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CIC</span><span class="w">  </span><span class="n">CIC</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">CIC</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="k">AND</span><span class="w"> </span><span class="n">CIC</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">ROG_ID</span>

<span class="c1">--JOIN EDM_VIEWS_PRD.DW_VIEWS.D0_FISCAL_DAY LDAY</span>
<span class="c1">--on TRANSACTION_DT = CALENDAR_DT</span>
<span class="c1">--AND LDAY.FISCAL_QUARTER_ID = 202104</span>

<span class="c1">--JOIN EDM_VIEWS_PRD.DW_VIEWS.LU_PROMO_DAY_MERGE_V PDAY  --UPDATE WHEN EDM D1-PROMOTION_CALENDAR_DAY is fixed</span>
<span class="c1">--ON AGP.TRANSACTION_DT = PDAY.D_DATE</span>
<span class="c1">--AND lpad(PDAY.DIVISION_ID,2,0)= RST.DIVISION_ID</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_PROMOTION_CALENDAR_DAY</span><span class="w"> </span><span class="n">PDAY</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">TRANSACTION_DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PDAY</span><span class="p">.</span><span class="w"> </span><span class="n">CALENDAR_DT</span>
<span class="k">AND</span><span class="w"> </span><span class="n">PDAY</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">DIVISION_ID</span>

<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_PROMOTION_CALENDAR_WEEK</span><span class="w"> </span><span class="n">PWK</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">PWK</span><span class="p">.</span><span class="n">PROMOTION_WEEK_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PDAY</span><span class="p">.</span><span class="n">PROMOTION_WEEK_ID</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">PWK</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">DIVISION_ID</span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">DIVISION_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;05&#39;</span><span class="p">,</span><span class="s1">&#39;17&#39;</span><span class="p">,</span><span class="s1">&#39;19&#39;</span><span class="p">,</span><span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="s1">&#39;25&#39;</span><span class="p">,</span><span class="s1">&#39;27&#39;</span><span class="p">,</span><span class="s1">&#39;29&#39;</span><span class="p">,</span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="s1">&#39;32&#39;</span><span class="p">,</span><span class="s1">&#39;33&#39;</span><span class="p">,</span><span class="s1">&#39;34&#39;</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w">  </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1509</span><span class="p">,</span><span class="mi">1708</span><span class="p">,</span><span class="mi">339</span><span class="p">,</span><span class="mi">3197</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">RST</span><span class="p">.</span><span class="n">ROG_ID</span><span class="w">  </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;AKBA&#39;</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">PWK</span><span class="p">.</span><span class="n">PROMOTION_WEEK_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">202152</span>
<span class="k">AND</span><span class="w"> </span><span class="n">AGP</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="mi">0</span>
<span class="c1">--AND  (UPC.SMIC_CATEGORY_ID &lt;9900 OR (UPC.SMIC_CATEGORY_ID IN (9902,9931,9932,9933,9934,9935,9937,9938,9939,9959,9961,9962,9963,9964,9966,9967,9968,9969,</span>
<span class="c1">--9972,9973,9974,9975,9976,9977,9978,9979,9985,9986,9987,9988,9989,9990,9991,9992,9993,9994,9995,9996,9997,9998,9999)))</span>
<span class="c1">--AND UPC.RETAIL_DEPARTMENT_ID NOT IN (&#39;339&#39;,&#39;304&#39;)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span>
</code></pre></div>
<h2 id="get-category-name-by-vendor">Get Category Name by Vendor<a class="headerlink" href="#get-category-name-by-vendor" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="p">(</span><span class="n">cat</span><span class="p">.</span><span class="n">smic_group_cd</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">smic_category_cd</span><span class="p">)::</span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORY_ID</span><span class="p">,</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">SMIC_CATEGORY_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORY_NM</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_BIZOPS_VIEWS</span><span class="p">.</span><span class="n">UPCFINWK_DEPT_DATA</span><span class="w"> </span><span class="n">dim</span>
<span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">SMIC_CATEGORY</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">right</span><span class="p">(</span><span class="n">dim</span><span class="p">.</span><span class="n">CATEGORY_ID</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cat</span><span class="p">.</span><span class="n">smic_group_cd</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">smic_category_cd</span><span class="p">)::</span><span class="nb">VARCHAR</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">CAT</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">CAT</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">SMIC_GROUP</span><span class="w"> </span><span class="n">grp</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">SMIC_GROUP_CD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grp</span><span class="p">.</span><span class="n">SMIC_GROUP_CD</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">GRP</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">GRP</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_BIZOPS_VIEWS</span><span class="p">.</span><span class="n">finwk_brandcd</span><span class="w"> </span><span class="n">mfg</span><span class="w"> </span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">MFG</span><span class="p">.</span><span class="n">L0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">DIM</span><span class="p">.</span><span class="n">BRAND_CD</span><span class="p">)</span><span class="w">                                </span>
<span class="w">        </span><span class="k">and</span><span class="w"> </span><span class="n">grp</span><span class="p">.</span><span class="n">SMIC_GROUP_CD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">MFG</span><span class="p">.</span><span class="n">L3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;L3 - PROCTER &amp; GAMBLE&#39;</span>
<span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<h2 id="store-upc-agp-by-category">Store UPC AGP by Category<a class="headerlink" href="#store-upc-agp-by-category" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">yr</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_swy_year_dt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_dt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dte</span><span class="w">  </span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_year_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">yr</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">year_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dte</span><span class="p">.</span><span class="n">year_id</span><span class="w"> </span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Current_Date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span>
<span class="w"> </span><span class="p">),</span>
<span class="n">dtes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_day_merge</span>
<span class="w">  </span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">yr</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">d_date</span><span class="w">  </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span>
<span class="w">                  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">wk</span><span class="p">.</span><span class="n">week_end_dt</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dte</span><span class="w"> </span>
<span class="w">                        </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_week_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">wk</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dte</span><span class="p">.</span><span class="n">week_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">.</span><span class="n">week_id</span><span class="w"> </span>
<span class="w">                        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Current_Date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">                   </span><span class="c1">-- Year to end of last week</span>
<span class="w">      </span><span class="k">OR</span><span class="w"> </span><span class="n">d_date</span><span class="w">   </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">364</span>
<span class="w">                  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">wk</span><span class="p">.</span><span class="n">week_end_dt</span><span class="w">  </span><span class="o">-</span><span class="mi">364</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_day_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dte</span><span class="w"> </span>
<span class="w">                        </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_week_merge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">wk</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dte</span><span class="p">.</span><span class="n">week_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">.</span><span class="n">week_id</span><span class="w"> </span>
<span class="w">                        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Current_Date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">       </span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">store_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">category_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">day_dt</span><span class="p">,</span>
<span class="w">    </span><span class="n">manuf_type_cd</span><span class="p">,</span>
<span class="w">    </span><span class="n">brand_cd</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">TY_sales</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_sales</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">LY_sales</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_sales</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">TY_qty</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_qty</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">LY_qty</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_qty</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">TY_lbs</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_lbs</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">LY_lbs</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_lbs</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">TY_agp</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_agp</span><span class="p">,</span>
<span class="w">    </span><span class="k">Sum</span><span class="p">(</span><span class="n">LY_agp</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_agp</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">ret</span><span class="p">.</span><span class="n">facility_nbr</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">store_id</span><span class="p">,</span>
<span class="w">        </span><span class="n">upc</span><span class="p">.</span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w">   </span><span class="k">ELSE</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">364</span><span class="w"> </span><span class="k">END</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">day_dt</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">manuf_type_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manuf_type_cd</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">manuf_type_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">brand_cd</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">brand_cd</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">TOTAL_NET_AMT</span><span class="w">  </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_sales</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">TOTAL_NET_AMT</span><span class="w">  </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_sales</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">ITEM_QTY</span><span class="w">       </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_qty</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">ITEM_QTY</span><span class="w">       </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_qty</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">MEASURED_QTY</span><span class="w">   </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_lbs</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">MEASURED_QTY</span><span class="w">   </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_lbs</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">AGP_EXTENDED_AMT</span><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_agp</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">yr</span><span class="p">.</span><span class="n">start_dt</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">AGP_EXTENDED_AMT</span><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_agp</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">store_upc_agp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sua</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">retail_store</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="w"> </span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_upc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">upc</span>
<span class="w">            </span><span class="k">ON</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">upc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sua</span><span class="p">.</span><span class="n">upc_nbr</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">yr</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w">  </span><span class="n">sua</span><span class="p">.</span><span class="n">transaction_dt</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dtes</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">AND</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">group_id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">99</span>
<span class="w">            </span><span class="k">AND</span><span class="w"> </span><span class="n">RET</span><span class="p">.</span><span class="n">FACILITY_NBR</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">9999</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w">   </span><span class="c1">-- Haggen Last Year</span>
<span class="w">        </span><span class="n">agp</span><span class="p">.</span><span class="n">store_id</span><span class="p">,</span>
<span class="w">        </span><span class="k">Coalesce</span><span class="p">(</span><span class="n">upc1</span><span class="p">.</span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span>
<span class="w">        </span><span class="n">agp</span><span class="p">.</span><span class="n">day_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">364</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">day_dt</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w">  </span><span class="n">ob</span><span class="p">.</span><span class="n">upc_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="k">OR</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">upc_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">GROUP_ID</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">MANUF_TYPE_CD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;N&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manuf_type_cd</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">manuf_type_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">brand_cd</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">brand_cd</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">::</span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                                 </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_sales</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">sum_net_amt</span><span class="w"> </span><span class="p">)</span><span class="w">                         </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_sales</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">::</span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                                 </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_Units</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">sum_item_qty</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_Units</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">::</span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                                 </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_lbs</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">sum_meas_qty</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_lbs</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">::</span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                                 </span><span class="k">AS</span><span class="w"> </span><span class="n">TY_GP</span><span class="p">,</span>
<span class="w">        </span><span class="k">Sum</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">sum_net_amt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">cost_of_goods_amt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LY_GP</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">hgn_store_upc_agp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">agp</span><span class="w"> </span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">hgn_upc_swy_hier_full</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">upc1</span><span class="w">     </span><span class="k">ON</span><span class="w"> </span><span class="n">upc1</span><span class="p">.</span><span class="n">hgn_upc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">hgn_upc_id</span><span class="w">     </span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">haggen_ob_upcs</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ob</span><span class="w">              </span><span class="k">ON</span><span class="w"> </span><span class="n">ob</span><span class="p">.</span><span class="n">upc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">upc_id</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">OB_MAIN</span><span class="p">.</span><span class="n">lu_upc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">upc</span><span class="w">                     </span><span class="k">ON</span><span class="w"> </span><span class="n">upc</span><span class="p">.</span><span class="n">upc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">upc_id</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">yr</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">agp</span><span class="p">.</span><span class="n">day_dt</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">d_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dtes</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Q</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
<h2 id="random-weight-meat-cost">Random weight meat cost<a class="headerlink" href="#random-weight-meat-cost" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">YPC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">DISTINCT</span>
<span class="w">        </span><span class="n">PRM</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">PRM</span><span class="p">.</span><span class="n">WAREHOUSE_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">PRM</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PRIMAL_CIC</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">DIV0</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SUM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">BASE_CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">88290059</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">88290061</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">88100217</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">88290060</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">880200497</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">880200259</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">88100109</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">YIELD_PCT</span><span class="w"> </span>
<span class="w">                          </span><span class="k">ELSE</span><span class="w"> </span><span class="n">YIELD_PCT</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PRIMAL_YIELD_ADJUSTMENT_PCT</span><span class="w"> </span>
<span class="w">                         </span><span class="o">//</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">non</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">direct</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="p">(</span><span class="n">ground</span><span class="w"> </span><span class="n">beef</span><span class="p">,</span><span class="w"> </span><span class="n">stew</span><span class="w"> </span><span class="n">meat</span><span class="p">,</span><span class="w"> </span><span class="k">cube</span><span class="w"> </span><span class="n">steak</span><span class="p">,</span><span class="w"> </span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">fat</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">loss</span><span class="p">)</span>
<span class="w">                         </span><span class="o">//</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">driver</span><span class="s1">&#39;s yield % is subtracted from the yield of the true driver</span>
<span class="s1">    FROM EDM_VIEWS_PRD.DW_VIEWS.PRIMAL_MEAT_ITEM_YIELD PRM</span>
<span class="s1">    JOIN EDM_VIEWS_PRD.DW_VIEWS.BASE_MEAT_ITEM_YIELD DRV</span>
<span class="s1">      ON PRM.DIVISION_ID = DRV.DIVISION_ID</span>
<span class="s1">     AND PRM.WAREHOUSE_ID = DRV.WAREHOUSE_ID</span>
<span class="s1">     AND PRM.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID = DRV.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="s1">     AND PRM.YIELD_CHART_NBR = DRV.YIELD_CHART_NBR</span>
<span class="s1">     AND PRM.DIVISION_ID = 27</span>
<span class="s1">     AND PRM.YIELD_CHART_NBR = 1</span>
<span class="s1">     AND PRM.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">     AND PRM.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="s1">     AND DRV.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">     AND DRV.DW_LOGICAL_DELETE_IND = FALSE </span>
<span class="s1">    GROUP BY 1 , 2 , 3 </span>
<span class="s1">) , YDO AS (</span>
<span class="s1">    SELECT </span>
<span class="s1">    DISTINCT</span>
<span class="s1">        YPD.DIVISION_ID</span>
<span class="s1">    ,   OPT.ROG_ID</span>
<span class="s1">    ,   YPD.DRIVER_CIC</span>
<span class="s1">    ,   YPD.DRIVER_DSC</span>
<span class="s1">    ,   OPT.OPTIONAL_CORPORATE_ITEM_CD</span>
<span class="s1">    ,   OPT.OPTIONAL_ITEM_DSC</span>
<span class="s1">    ,   CASE WHEN YPD.DRIVER_CIC IN ( 88290059 , 88290061 , 88100217 , 88290060 , 880200497 , 880200259 , 88100109 ) </span>
<span class="s1">             THEN DIV0 ( SUM ( YPD.DRIVER_TOTAL_SHIPPED_COST ) , SUM ( YPD.DRIVER_POUNDS_SHIPPED ) )</span>
<span class="s1">             ELSE DIV0 ( SUM ( YPD.DRIVER_TOTAL_SHIPPED_COST ) , SUM ( YPD.DRIVER_POUNDS_SHIPPED ) ) * AVG ( 2 - YPD.PRIMAL_YIELD_ADJUSTMENT_PCT )</span>
<span class="s1">             END AS YIELD_ADJUSTED_COST</span>
<span class="s1">     FROM (</span>
<span class="s1">        SELECT </span>
<span class="s1">        DISTINCT </span>
<span class="s1">            YCH.DIVISION_ID</span>
<span class="s1">        ,   YCH.WAREHOUSE_ID</span>
<span class="s1">        ,   YCH.PRIMAL_CIC</span>
<span class="s1">        ,   YCH.PRIMAL_ITEM_DSC</span>
<span class="s1">        ,   YCH.DRIVER_CIC</span>
<span class="s1">        ,   YCH.DRIVER_DSC</span>
<span class="s1">        ,   YPC.PRIMAL_YIELD_ADJUSTMENT_PCT</span>
<span class="s1">        ,   YCH.YIELD_PCT</span>
<span class="s1">        ,   SUM ( SID.SHIPPED_QTY * SID.DETAIL_CHARGES_CHARGE2_AMT ) * YCH.YIELD_PCT AS DRIVER_TOTAL_SHIPPED_COST</span>
<span class="s1">        ,   SUM ( SID.CASE_WGT ) * YCH.YIELD_PCT AS DRIVER_POUNDS_SHIPPED</span>
<span class="s1">        FROM ( </span>
<span class="s1">            SELECT</span>
<span class="s1">            DISTINCT</span>
<span class="s1">                PRM.DIVISION_ID</span>
<span class="s1">            ,   PRM.WAREHOUSE_ID</span>
<span class="s1">            ,   PRM.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="s1">            ,   PRM.CORPORATE_ITEM_CD AS PRIMAL_CIC</span>
<span class="s1">            ,   PRM.PRIMAL_ITEM_DSC</span>
<span class="s1">            ,   DRV.BASE_CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="s1">            ,   CASE WHEN DRV.BASE_CORPORATE_ITEM_CD = 88100109 THEN 88100217 ELSE DRV.BASE_CORPORATE_ITEM_CD END AS DRIVER_CIC</span>
<span class="s1">            ,   DRV.BASE_ITEM_DSC AS DRIVER_DSC</span>
<span class="s1">            ,   DIV0 ( CASE WHEN PRM.CORPORATE_ITEM_CD NOT  IN ( 88290059 , 88290061 , 88100217 , 88290060 , 880200497 , 880200259 , 88100109 ) </span>
<span class="s1">                            THEN CASE WHEN DRV.YIELD_PCT = 0 THEN 1 ELSE DRV.YIELD_PCT END END , 100 ) AS YIELD_PCT // the raw yield percent for all drivers is kept to provide driver costs for ground beef etc</span>
<span class="s1">            FROM EDM_VIEWS_PRD.DW_VIEWS.PRIMAL_MEAT_ITEM_YIELD PRM</span>
<span class="s1">            JOIN EDM_VIEWS_PRD.DW_VIEWS.BASE_MEAT_ITEM_YIELD DRV</span>
<span class="s1">              ON PRM.DIVISION_ID = DRV.DIVISION_ID</span>
<span class="s1">             AND PRM.WAREHOUSE_ID = DRV.WAREHOUSE_ID</span>
<span class="s1">             AND PRM.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID = DRV.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="s1">             AND PRM.YIELD_CHART_NBR = DRV.YIELD_CHART_NBR</span>
<span class="s1">             AND PRM.YIELD_CHART_NBR = 1</span>
<span class="s1">             AND PRM.DIVISION_ID = 27</span>
<span class="s1">             AND PRM.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">             AND PRM.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="s1">             AND DRV.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">             AND DRV.DW_LOGICAL_DELETE_IND = FALSE </span>
<span class="s1">        ) YCH</span>
<span class="s1">        JOIN EDM_VIEWS_PRD.DW_VIEWS.SUPPLY_CHAIN_INVOICE_HEADER SIH</span>
<span class="s1">          ON YCH.WAREHOUSE_ID = SIH.WAREHOUSE_ID</span>
<span class="s1">         AND YCH.DIVISION_ID = SIH.DIVISION_ID</span>
<span class="s1">        INNER</span>
<span class="s1">        JOIN EDM_VIEWS_PRD.DW_VIEWS.SUPPLY_CHAIN_INVOICE_DETAIL SID</span>
<span class="s1">          ON SIH.SUPPLY_CHAIN_INVOICE_INTEGRATION_ID = SID.SUPPLY_CHAIN_INVOICE_INTEGRATION_ID</span>
<span class="s1">         AND YCH.PRIMAL_CORPORATE_ITEM_INTEGRATION_ID = SID.CORPORATE_ITEM_INTEGRATION_ID</span>
<span class="s1">         AND SIH.DW_FIRST_EFFECTIVE_DT = SID.DW_FIRST_EFFECTIVE_DT</span>
<span class="s1">         AND SIH.DW_LAST_EFFECTIVE_DT = SID.DW_LAST_EFFECTIVE_DT</span>
<span class="s1">         AND SIH.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="s1">         AND SIH.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">         AND SID.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="s1">         AND SID.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">         AND SIH.CORPORATION_ID = 1</span>
<span class="s1">         AND SIH.REQUESTED_DELIVERY_DT BETWEEN CURRENT_DATE - 28 AND CURRENT_DATE</span>
<span class="s1">        JOIN YPC</span>
<span class="s1">          ON YCH.DIVISION_ID = YPC.DIVISION_ID</span>
<span class="s1">         AND YCH.WAREHOUSE_ID = YPC.WAREHOUSE_ID</span>
<span class="s1">         AND YCH.PRIMAL_CIC = YPC.PRIMAL_CIC</span>
<span class="s1">         AND SIH.WAREHOUSE_ID = YPC.WAREHOUSE_ID</span>
<span class="s1">         AND SIH.DIVISION_ID = YPC.DIVISION_ID</span>
<span class="s1">        GROUP BY 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 </span>
<span class="s1">    ) YPD</span>
<span class="s1">    JOIN EDM_VIEWS_PRD.DW_VIEWS.OPTIONAL_MEAT_ITEM_YIELD OPT</span>
<span class="s1">      ON YPD.DIVISION_ID = OPT.DIVISION_ID</span>
<span class="s1">     AND YPD.WAREHOUSE_ID = OPT.WAREHOUSE_ID</span>
<span class="s1">     AND YPD.PRIMAL_CIC = OPT.CORPORATE_ITEM_CD</span>
<span class="s1">     AND YPD.DRIVER_CIC = OPT.BASE_CORPORATE_ITEM_CD</span>
<span class="s1">     AND OPT.DW_CURRENT_VERSION_IND = TRUE</span>
<span class="s1">     AND OPT.DW_LOGICAL_DELETE_IND = FALSE</span>
<span class="s1">    WHERE ROG_ID NOT IN ( &#39;</span><span class="n">SHGN</span><span class="err">&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="k">DISTINCT</span>
<span class="w">    </span><span class="n">AGG</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">AGG</span><span class="p">.</span><span class="n">ROG_ID</span>
<span class="p">,</span><span class="w">   </span><span class="n">AGG</span><span class="p">.</span><span class="n">CORPORATE_ITEM_CD</span>
<span class="p">,</span><span class="w">   </span><span class="n">AGG</span><span class="p">.</span><span class="n">ITEM_DSC</span>
<span class="p">,</span><span class="w">   </span><span class="n">AGG</span><span class="p">.</span><span class="n">YIELD_ADJUSTED_COST</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">DISTINCT</span><span class="w"> </span>
<span class="w">        </span><span class="n">YDO</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">ROG_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">DRIVER_CIC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CORPORATE_ITEM_CD</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">DRIVER_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ITEM_DSC</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="k">MAX</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">YDO</span><span class="p">.</span><span class="n">YIELD_ADJUSTED_COST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">YIELD_ADJUSTED_COST</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">YDO</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span>
<span class="w">        </span><span class="n">YDO</span><span class="p">.</span><span class="n">DIVISION_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">ROG_ID</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">OPTIONAL_CORPORATE_ITEM_CD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CORPORATE_ITEM_CD</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="n">YDO</span><span class="p">.</span><span class="n">OPTIONAL_ITEM_DSC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ITEM_DSC</span>
<span class="w">    </span><span class="p">,</span><span class="w">   </span><span class="k">MAX</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">YDO</span><span class="p">.</span><span class="n">YIELD_ADJUSTED_COST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">YIELD_ADJUSTED_COST</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">YDO</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="p">)</span><span class="w"> </span><span class="n">AGG</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
</code></pre></div>
<h2 id="planogram-schematic-fixture">Planogram Schematic Fixture<a class="headerlink" href="#planogram-schematic-fixture" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="n">POG</span><span class="p">.</span><span class="n">Planogram_Nm</span><span class="p">,</span>
<span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_ID</span><span class="p">,</span>
<span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_DSC</span><span class="p">,</span>
<span class="n">FXTR</span><span class="p">.</span><span class="n">SHELF_SURFACE_CD</span>

<span class="w"> </span><span class="k">FROM</span><span class="w"> </span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM_SLOT_ITEM</span><span class="w"> </span><span class="n">ITEM</span>
<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM</span><span class="w"> </span><span class="n">POG</span>
<span class="k">on</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span>
<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM_STORE_FIXTURE</span><span class="w"> </span><span class="n">STORE</span>
<span class="k">on</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span>
<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM_FIXTURE_SHELF</span><span class="w"> </span><span class="n">FXTR</span>
<span class="k">on</span><span class="w">  </span><span class="n">POG</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FXTR</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span>
<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_UPC</span><span class="w"> </span><span class="n">UPC</span>
<span class="k">on</span><span class="w">  </span><span class="n">UPC</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="k">join</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">FACILITY</span><span class="w"> </span><span class="n">STR</span>
<span class="k">on</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="k">WHERE</span>
<span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">CLOSE_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="w"> </span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">STORE_SCHEMATIC_EFFECTIVE_END_DT</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="k">CURRENT_DATE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="w">  </span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">FXTR</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">FXTR</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">FALSE</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;001&#39;</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">FACILITY_TYPE_CD</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;RT&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">FXTR</span><span class="p">.</span><span class="w"> </span><span class="n">SHELF_SURFACE_CD</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Pegboard&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">CORPORATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">AND</span><span class="w"> </span><span class="n">UPC</span><span class="p">.</span><span class="n">SMIC_CATEGORY_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;3001&#39;</span><span class="p">,</span><span class="s1">&#39;3004&#39;</span><span class="p">,</span><span class="s1">&#39;3002&#39;</span><span class="p">)</span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">;</span>
</code></pre></div>
<h2 id="distribution-voids">Distribution voids<a class="headerlink" href="#distribution-voids" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="n">DIVISION_NM</span><span class="p">,</span>
<span class="n">BANNER_NM</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">DISTRIBUTION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRIBUTION</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SALES</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SHIPPED</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">TAG_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TAG_QTY</span>

<span class="k">FROM</span>

<span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
<span class="n">DIVISION_NM</span><span class="p">,</span>
<span class="n">TB3</span><span class="p">.</span><span class="n">BANNER_NM</span><span class="p">,</span><span class="w"> </span>
<span class="n">TB3</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="p">,</span>
<span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">TB3</span><span class="p">.</span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">DISTRIBUTION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRIBUTION</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SALES</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SHIPPED</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">TAG</span><span class="p">.</span><span class="n">TAG_NBR</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TAG_QTY</span>

<span class="k">FROM</span><span class="w"> </span>
<span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
<span class="n">DIVISION_NM</span><span class="p">,</span>
<span class="n">BANNER_NM</span><span class="p">,</span><span class="w"> </span>
<span class="n">UPC_NBR</span><span class="p">,</span>
<span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">FACILITY_INTEGRATION_ID</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">DISTRIBUTION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRIBUTION</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SALES</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SHIPPED</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span>

<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="n">TB</span><span class="p">.</span><span class="n">DIVISION_NM</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">BANNER_nm</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">UPC_nbr</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">TB</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">TB</span><span class="p">.</span><span class="n">DIST</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISTRIBUTION</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">TB</span><span class="p">.</span><span class="n">SALES_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">SHIPPED</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="n">STR</span><span class="p">.</span><span class="n">DIVISION_NM</span><span class="p">,</span><span class="w"> </span>
<span class="n">STR</span><span class="p">.</span><span class="n">BANNER_NM</span><span class="p">,</span><span class="w"> </span>
<span class="n">ITEM</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="p">,</span><span class="w"> </span>
<span class="n">DEPT</span><span class="p">.</span><span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">DEPT</span><span class="p">.</span><span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="p">,</span>
<span class="k">Cast</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DIST</span><span class="p">,</span>
<span class="k">Cast</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES_QTY</span><span class="p">,</span>
<span class="k">Cast</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM_SLOT_ITEM</span><span class="w"> </span><span class="n">ITEM</span><span class="p">,</span><span class="w"> </span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Planogram</span><span class="w"> </span><span class="n">POG</span><span class="p">,</span><span class="w"> </span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">PLANOGRAM_STORE_FIXTURE</span><span class="w"> </span><span class="n">STORE</span><span class="p">,</span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_RETAIL_STORE</span><span class="w"> </span><span class="n">STR</span><span class="p">,</span>
<span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_BIZOPS_VIEWS</span><span class="p">.</span><span class="n">UPCFINWK_DEPT_DATA</span><span class="w"> </span><span class="n">DEPT</span>
<span class="k">WHERE</span>
<span class="n">ITEM</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span>
<span class="k">and</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="k">and</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">POG</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">PLANOGRAM_ID</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>
<span class="c1">--AND STR.DIVISION_ID = 29</span>
<span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">CLOSE_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">Current_Date</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">STORE</span><span class="p">.</span><span class="n">STORE_SCHEMATIC_EFFECTIVE_END_DT</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="k">Current_Date</span>
<span class="k">AND</span><span class="w"> </span><span class="n">ITEM</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEPT</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="k">AND</span><span class="w"> </span><span class="n">DEPT</span><span class="p">.</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;OC%&#39;</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">Substr</span><span class="p">(</span><span class="n">UPC_NM</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;O&#39;</span>
<span class="k">AND</span><span class="w">  </span><span class="n">DEPT</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">19067900008</span><span class="p">,</span>
<span class="mi">19067900002</span><span class="p">,</span>
<span class="mi">19067900018</span><span class="p">,</span>
<span class="mi">19067900001</span><span class="p">,</span>
<span class="mi">19067900012</span><span class="p">,</span>
<span class="mi">19067900011</span><span class="p">)</span><span class="w"> </span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>

<span class="k">SELECT</span><span class="w">  </span>
<span class="n">STR</span><span class="p">.</span><span class="n">DIVISION_NM</span><span class="p">,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">BANNER_nm</span><span class="p">,</span>
<span class="k">Abs</span><span class="p">(</span><span class="n">SALES</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UPC_NBR</span><span class="p">,</span>
<span class="n">DEPT</span><span class="p">.</span><span class="n">DESCRIPTION</span><span class="p">,</span>
<span class="n">DEPT</span><span class="p">.</span><span class="n">CATEGORY_NM</span><span class="p">,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">STORE_ID</span><span class="p">,</span>
<span class="n">STR</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="p">,</span>
<span class="k">Cast</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DIST</span><span class="p">,</span>
<span class="k">Sum</span><span class="p">(</span><span class="n">ITEM_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALES_QTY</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">SALES</span><span class="p">.</span><span class="n">WHSE_SHIPPED_UNIT_QTY</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">SALES</span><span class="p">.</span><span class="n">BDR_SHIPPED_UNIT_QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SHIPPED</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_BIZOPS_VIEWS</span><span class="p">.</span><span class="n">STRFINWK_DATA_COMBINED</span><span class="w"> </span><span class="n">SALES</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">D1_RETAIL_STORE</span><span class="w"> </span><span class="n">STR</span>
<span class="w">    </span><span class="k">ON</span><span class="w">  </span><span class="n">SALES</span><span class="p">.</span><span class="n">Facility_nbr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">RETAIL_STORE_FACILITY_NBR</span><span class="w"> </span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">STR</span><span class="p">.</span><span class="n">CLOSE_DT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">Current_Date</span>
<span class="w">    </span><span class="c1">--AND   STR.DIVESTED_FLAG IN (&#39;N&#39;)</span>
<span class="w">    </span><span class="c1">--AND STR.DIVISION_ID = 29</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">FISCAL_WEEK_ID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="n">FISCAL_YEAR_NBR</span><span class="o">||</span><span class="n">LPAD</span><span class="p">(</span><span class="n">FISCAL_WEEK_NBR</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">WEEK_ID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">Calendar</span>
<span class="w">                           </span><span class="k">WHERE</span><span class="w"> </span><span class="n">calendar_dt</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="k">Current_Date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">180</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">Current_Date</span><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="k">FALSE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_BIZOPS_VIEWS</span><span class="p">.</span><span class="n">UPCFINWK_DEPT_DATA</span><span class="w"> </span><span class="n">DEPT</span>
<span class="k">ON</span><span class="w"> </span><span class="n">SALES</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEPT</span><span class="p">.</span><span class="n">UPC_NBR</span>
<span class="k">AND</span><span class="w"> </span><span class="n">DEPT</span><span class="p">.</span><span class="n">CATEGORY_ID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;OC%&#39;</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Substr</span><span class="p">(</span><span class="n">UPC_NM</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;O&#39;</span>
<span class="k">AND</span><span class="w">  </span><span class="n">DEPT</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">19067900008</span><span class="p">,</span>
<span class="mi">19067900002</span><span class="p">,</span>
<span class="mi">19067900018</span><span class="p">,</span>
<span class="mi">19067900001</span><span class="p">,</span>
<span class="mi">19067900012</span><span class="p">,</span>
<span class="mi">19067900011</span><span class="p">)</span><span class="w"> </span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="n">TB</span><span class="w"> </span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="n">TB2</span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="n">TB3</span>


<span class="k">JOIN</span><span class="w"> </span><span class="n">EDM_VIEWS_PRD</span><span class="p">.</span><span class="n">DW_VIEWS</span><span class="p">.</span><span class="n">RETAIL_STORE_ITEM_LOCATION</span><span class="w"> </span><span class="n">TAG</span>
<span class="k">ON</span><span class="w"> </span><span class="n">TAG</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB3</span><span class="p">.</span><span class="n">UPC_NBR</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TAG</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span><span class="o">=</span><span class="n">TB3</span><span class="p">.</span><span class="n">FACILITY_INTEGRATION_ID</span>
<span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TAG</span><span class="p">.</span><span class="n">DW_LOGICAL_DELETE_IND</span><span class="w"> </span><span class="o">=</span><span class="k">FALSE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TAG</span><span class="p">.</span><span class="n">DW_CURRENT_VERSION_IND</span><span class="w"> </span><span class="o">=</span><span class="k">TRUE</span>


<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="n">TB</span>
<span class="c1">--WHERE TB.DIVISION_NM = &#39;ACME&#39; </span>

<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">;</span>
</code></pre></div>
<h2 id="sales-with-household-and-customer-data-penetration">Sales with Household and customer data penetration<a class="headerlink" href="#sales-with-household-and-customer-data-penetration" title="Permanent link">&para;</a></h2>
<p>```sql
  SELECT
TB.UPC_ID as upc
,TB.ITEM_DSC as upc_dsc
,TB.SMIC_CATEGORY_ID as category_id
,TB.DIVISION_NM as div
,TB.WEEK_ID as week_id
,SUM(TB.TOTAL_NET_SALES_TY) AS total_sales_ty
,SUM(TB.TOTAL_NET_SALES_LY) AS total_sales_ly
,SUM(TB.ITEM_QTY_TY) AS total_qty_ty
,SUM(TB.ITEM_QTY_LY) AS total_qty_ly
,SUM(TB.BASKETS_TY) AS total_baskets_ty
,SUM(TB.BASKETS_LY) AS total_baskets_ly
,SUM(TB.HOUSEHOLDS_TY) AS total_households_ty
,SUM(TB.HOUSEHOLDS_LY) AS total_households_ly
,SUM(TB.EBG_NET_SALES_TY) AS ebg_net_sales_ty
,SUM(TB.EBG_NET_SALES_LY) AS ebg_net_sales_ly
,SUM(TB.EBG_ITEM_QTY_TY) AS ebg_qty_ty
,SUM(TB.EBG_ITEM_QTY_LY) AS ebg_qty_ly
,SUM(TB.EBG_BASKETS_TY) AS ebg_baskets_ty
,SUM(TB.EBG_BASKETS_LY) AS ebg_baskets_ly
,SUM(TB.EBG_HOUSEHOLDS_TY) AS ebg_households_ty
,SUM(TB.EBG_HOUSEHOLDS_LY) AS ebg_households_ly</p>
<p>FROM(
(SELECT 
       T1.UPC_ID
      ,T1.ITEM_DSC
      ,T1.SMIC_CATEGORY_ID
      ,T1.DIVISION_NM
      ,T1.WEEK_ID
      ,T1.TOTAL_NET_SALES AS TOTAL_NET_SALES_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS TOTAL_NET_SALES_LY
      ,T1.ITEM_QTY AS ITEM_QTY_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS ITEM_QTY_LY
      ,T1.BASKETS AS BASKETS_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS BASKETS_LY
      ,T1.HOUSEHOLDS AS HOUSEHOLDS_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS HOUSEHOLDS_LY
      ,T2.EBG_NET_SALES AS EBG_NET_SALES_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_NET_SALES_LY
      ,T2.EBG_ITEM_QTY AS EBG_ITEM_QTY_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_ITEM_QTY_LY
      ,T2.EBG_BASKETS AS EBG_BASKETS_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_BASKETS_LY
      ,T2.EBG_HOUSEHOLDS AS EBG_HOUSEHOLDS_TY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_HOUSEHOLDS_LY
FROM (SELECT A.UPC_ID
            ,E.ITEM_DSC
            ,E.SMIC_CATEGORY_ID
            ,D.DIVISION_NM
            ,WEEK.WEEK_ID
            ,CAST(SUM(A.NET_AMT + A.MKDN_WOD_ALLOC_AMT + A.MKDN_POD_ALLOC_AMT) AS DECIMAL(18, 4)) AS TOTAL_NET_SALES
            ,CAST(SUM(ITEM_QTY) AS DECIMAL(18, 4)) AS ITEM_QTY
            ,COUNT(DISTINCT TXN_ID) AS BASKETS
            ,COUNT(DISTINCT CARD_NBR) AS HOUSEHOLDS
      FROM  (select * from EDM_VIEWS_PRD.DW_EDW_VIEWS.TXN_FACTS where txn_dte &gt; '2022-01-01') A
            ,EDM_VIEWS_PRD.DW_VIEWS.RETAIL_STORE C
           ,EDM_VIEWS_PRD.DW_VIEWS.DIVISION D 
            ,EDM_VIEWS_PRD.DW_VIEWS.D1_UPC E
            ,EDM_VIEWS_PRD.DW_EDW_VIEWS.LIFESTYLE_SAME_STR_DAY same
            ,EDM_SANDBOX_PRD.CORE_TECH.ZHU_COMP_WEEK week
            ,EDM_VIEWS_PRD.DW_VIEWS.Calendar merge
      WHERE  E.UPC_NBR = A.UPC_ID
        AND  A.UPC_ID IN  (7940046281,7940046279,7940046273,7940046272,7940046271,2279691752,2279691751,2279691671,2279691670,2279691612,2279691611,2279691602,2279691601,2279691432,2279691431,2279691015,2279691014,2279691006,2279691005,2279690092,2279690090,8087817207,8087804238,8087817205,8087817206,8087804219,8087804235,8087804222,8087804225,8087800899,8087800406,8087804216,8087800218,8087817125,8087817126)
        AND  merge.CALENDAR_DT = A.txn_dte
         AND A.STORE_ID = C.FACILITY_NBR 
         AND c.DW_CURRENT_VERSION_IND =TRUE AND c.DW_LOGICAL_DELETE_IND =FALSE
         AND c.CORPORATION_ID='001'
         AND  D.DIVISION_ID=C.DIVISION_ID
           AND D.DW_CURRENT_VERSION_IND =TRUE AND D.DW_LOGICAL_DELETE_IND =FALSE
        AND  same.store_id = A.store_id
        AND  same.txn_dt = A.txn_dte and same_store_ind = 'Y'
        AND  week.current_week_id = (merge.FISCAL_YEAR_NBR ||LPAD(merge.Fiscal_Week_Nbr,2,0)) 
        and merge.DW_CURRENT_VERSION_IND =TRUE and MERGE.DW_LOGICAL_DELETE_IND =FALSE <br />
        and current_week_id &gt;= 202001 and data_refresh_dt &lt; current_date</p>
<pre><code>    AND  E.CORPORATION_ID = 1
    AND  A.MISC_ITEM_QTY = 0
    AND  A.DEPOSIT_ITEM_QTY = 0
    AND  C.DIVISION_ID IN (5,15,17,19,20,23,29,30,32,33,34,35,25,27)
    AND  A.REV_DTL_SUBTYPE_ID IN (0, 7)
  GROUP BY 1,2,3,4,5
  ) AS T1

  LEFT JOIN
  (SELECT A.UPC_ID
         ,E.ITEM_DSC
         ,E.SMIC_CATEGORY_ID
         ,D.DIVISION_NM
         ,week.WEEK_ID
         ,CAST(SUM(A.NET_AMT + A.MKDN_WOD_ALLOC_AMT + A.MKDN_POD_ALLOC_AMT) AS DECIMAL(18, 4)) AS EBG_NET_SALES
         ,CAST(SUM(ITEM_QTY) AS DECIMAL(18, 4)) AS EBG_ITEM_QTY
         ,COUNT(DISTINCT TXN_ID) AS EBG_BASKETS
         ,COUNT(DISTINCT A.CARD_NBR) AS EBG_HOUSEHOLDS
   FROM   (select * from EDM_VIEWS_PRD.DW_EDW_VIEWS.TXN_FACTS where txn_dte &gt; '2022-01-01') A
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.RETAIL_STORE C  ON A.STORE_ID = C.FACILITY_NBR 
   AND c.DW_CURRENT_VERSION_IND =TRUE AND c.DW_LOGICAL_DELETE_IND =FALSE
    AND c.CORPORATION_ID='001'
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.DIVISION D 
      ON D.DIVISION_ID=C.DIVISION_ID
    AND D.DW_CURRENT_VERSION_IND =TRUE AND D.DW_LOGICAL_DELETE_IND =FALSE
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.D1_UPC E ON E.UPC_NBR = A.UPC_ID AND E.CORPORATION_ID = 1
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.SMV_LOYALTY_PROGRAM_RETAIL_CUSTOMER_HOUSEHOLD F ON A.CARD_NBR = F.LOYALTY_PROGRAM_CARD_NBR

      AND A.MISC_ITEM_QTY = 0
      AND A.DEPOSIT_ITEM_QTY = 0
   AND  A.UPC_ID IN  (7940046281,7940046279,7940046273,7940046272,7940046271,2279691752,2279691751,2279691671,2279691670,2279691612,2279691611,2279691602,2279691601,2279691432,2279691431,2279691015,2279691014,2279691006,2279691005,2279690092,2279690090,8087817207,8087804238,8087817205,8087817206,8087804219,8087804235,8087804222,8087804225,8087800899,8087800406,8087804216,8087800218,8087817125,8087817126)
   JOIN EDM_VIEWS_PRD.DW_VIEWS.Calendar merge on merge.CALENDAR_DT = A.txn_dte JOIN EDM_SANDBOX_PRD.CORE_TECH.ZHU_COMP_WEEK week on week.current_week_id =   (merge.FISCAL_YEAR_NBR ||LPAD(merge.Fiscal_Week_Nbr,2,0)) and merge.DW_CURRENT_VERSION_IND =TRUE and MERGE.DW_LOGICAL_DELETE_IND =FALSE   and current_week_id &gt;= 202001 and data_refresh_dt &lt; current_date
   JOIN EDM_VIEWS_PRD.DW_EDW_VIEWS.LIFESTYLE_SAME_STR_DAY same on same.store_id = A.store_id AND  same.txn_dt = A.txn_dte and same_store_ind = 'Y'
   LEFT JOIN (SELECT HOUSEHOLD_ID
                    ,ANNUAL_LEVEL2_SEGMENT_ID
                    ,WEEK_ID
                    ,CASE WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (1) THEN 'ELITE'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (2) THEN 'BEST'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (3, 4) THEN 'GOOD'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (5, 6) THEN 'OCCASIONAL'
                          ELSE 'UNKNOWN'
                          END AS FACTS_SEG_DESC
              FROM EDM_VIEWS_PRD.DW_EDW_VIEWS.FACTS_SEGMENT_WEEK
              GROUP BY 1, 2, 3, 4
    ) AS FACTS ON FACTS.HOUSEHOLD_ID = F.HOUSEHOLD_ID AND FACTS.WEEK_ID = current_week_id

      AND A.REV_DTL_SUBTYPE_ID IN (0, 7)
      AND FACTS.ANNUAL_LEVEL2_SEGMENT_ID IN (1,2,3,4)
    GROUP BY 1,2,3,4,5
    ) AS T2
</code></pre>
<p>ON T1.UPC_ID = T2.UPC_ID
AND T1.DIVISION_NM = T2.DIVISION_NM AND T1.WEEK_ID = T2.WEEK_ID)</p>
<p>UNION ALL</p>
<p>(SELECT T1.UPC_ID
      ,T1.ITEM_DSC
      ,T1.SMIC_CATEGORY_ID
      ,T1.DIVISION_NM
      ,T1.WEEK_ID
      ,CAST(0.00 AS DECIMAL (19,1))  AS TOTAL_NET_SALES_TY
      ,T1.TOTAL_NET_SALES AS TOTAL_NET_SALES_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS ITEM_QTY_TY
      ,T1.ITEM_QTY AS ITEM_QTY_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS BASKETS_TY
      ,T1.BASKETS AS BASKETS_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS HOUSEHOLDS_TY
      ,T1.HOUSEHOLDS AS HOUSEHOLDS_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_NET_SALES_TY
      ,T2.EBG_NET_SALES AS EBG_NET_SALES_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_ITEM_QTY_TY
      ,T2.EBG_ITEM_QTY AS EBG_ITEM_QTY_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_BASKETS_TY
      ,T2.EBG_BASKETS AS EBG_BASKETS_LY
      ,CAST(0.00 AS DECIMAL (19,1))  AS EBG_HOUSEHOLDS_TY
      ,T2.EBG_HOUSEHOLDS AS EBG_HOUSEHOLDS_LY
FROM (SELECT A.UPC_ID
            ,E.ITEM_DSC
            ,E.SMIC_CATEGORY_ID
            ,D.DIVISION_NM
            ,WEEK.WEEK_ID
            ,CAST(SUM(A.NET_AMT + A.MKDN_WOD_ALLOC_AMT + A.MKDN_POD_ALLOC_AMT) AS DECIMAL(18, 4)) AS TOTAL_NET_SALES
            ,CAST(SUM(ITEM_QTY) AS DECIMAL(18, 4)) AS ITEM_QTY
            ,COUNT(DISTINCT TXN_ID) AS BASKETS
            ,COUNT(DISTINCT CARD_NBR) AS HOUSEHOLDS
      FROM   (select * from EDM_VIEWS_PRD.DW_EDW_VIEWS.TXN_FACTS where txn_dte &gt; '2022-01-01') A
            , EDM_VIEWS_PRD.DW_VIEWS.RETAIL_STORE C<br />
             , EDM_VIEWS_PRD.DW_VIEWS.DIVISION D 
            ,EDM_VIEWS_PRD.DW_VIEWS.D1_UPC E
            ,EDM_VIEWS_PRD.DW_EDW_VIEWS.LIFESTYLE_SAME_STR_DAY same
            ,EDM_SANDBOX_PRD.CORE_TECH.ZHU_COMP_WEEK week
            ,EDM_VIEWS_PRD.DW_VIEWS.Calendar merge
      WHERE  E.UPC_NBR = A.UPC_ID
        AND  A.UPC_ID IN  (7940046281,7940046279,7940046273,7940046272,7940046271,2279691752,2279691751,2279691671,2279691670,2279691612,2279691611,2279691602,2279691601,2279691432,2279691431,2279691015,2279691014,2279691006,2279691005,2279690092,2279690090,8087817207,8087804238,8087817205,8087817206,8087804219,8087804235,8087804222,8087804225,8087800899,8087800406,8087804216,8087800218,8087817125,8087817126)
        AND  merge.CALENDAR_DT = A.txn_dte
        AND   A.STORE_ID = C.FACILITY_NBR 
       AND c.DW_CURRENT_VERSION_IND =TRUE AND c.DW_LOGICAL_DELETE_IND =FALSE
        AND c.CORPORATION_ID='001'
        AND D.DIVISION_ID=C.DIVISION_ID
        AND D.DW_CURRENT_VERSION_IND =TRUE AND D.DW_LOGICAL_DELETE_IND =FALSE 
        AND  same.store_id = A.store_id
        AND  same.txn_dt = A.txn_dte and same_store_ind = 'Y'
        AND  week.comp_week_id = (merge.FISCAL_YEAR_NBR ||LPAD(merge.Fiscal_Week_Nbr,2,0)) and merge.DW_CURRENT_VERSION_IND =TRUE and MERGE.DW_LOGICAL_DELETE_IND =FALSE  and current_week_id &gt;= 202001 and data_refresh_dt &lt; current_date</p>
<pre><code>    AND  E.CORPORATION_ID = 1
    AND  A.MISC_ITEM_QTY = 0
    AND  A.DEPOSIT_ITEM_QTY = 0
    AND  C.DIVISION_ID IN (5,15,17,19,20,23,29,30,32,33,34,35,25,27)
    AND  A.REV_DTL_SUBTYPE_ID IN (0, 7)
  GROUP BY 1,2,3,4,5
  ) AS T1

  LEFT JOIN
  (SELECT A.UPC_ID
         ,E.ITEM_DSC
         ,E.SMIC_CATEGORY_ID
         ,D.DIVISION_NM
         ,WEEK.WEEK_ID
         ,CAST(SUM(A.NET_AMT + A.MKDN_WOD_ALLOC_AMT + A.MKDN_POD_ALLOC_AMT) AS DECIMAL(18, 4)) AS EBG_NET_SALES
         ,CAST(SUM(ITEM_QTY) AS DECIMAL(18, 4)) AS EBG_ITEM_QTY
         ,COUNT(DISTINCT TXN_ID) AS EBG_BASKETS
         ,COUNT(DISTINCT A.CARD_NBR) AS EBG_HOUSEHOLDS
   FROM   (select * from EDM_VIEWS_PRD.DW_EDW_VIEWS.TXN_FACTS where txn_dte &gt; '2022-01-01') A
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.RETAIL_STORE C  ON A.STORE_ID = C.FACILITY_NBR 
   AND c.DW_CURRENT_VERSION_IND =TRUE AND c.DW_LOGICAL_DELETE_IND =FALSE
    AND c.CORPORATION_ID='001'
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.DIVISION D 
      ON D.DIVISION_ID=C.DIVISION_ID
    AND D.DW_CURRENT_VERSION_IND =TRUE AND D.DW_LOGICAL_DELETE_IND =FALSE
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.D1_UPC E ON E.UPC_NBR = A.UPC_ID AND E.CORPORATION_ID = 1
   INNER JOIN EDM_VIEWS_PRD.DW_VIEWS.SMV_LOYALTY_PROGRAM_RETAIL_CUSTOMER_HOUSEHOLD F ON A.CARD_NBR = F.LOYALTY_PROGRAM_CARD_NBR     
      AND A.MISC_ITEM_QTY = 0
      AND A.DEPOSIT_ITEM_QTY = 0
   AND  A.UPC_ID IN  (7940046281,7940046279,7940046273,7940046272,7940046271,2279691752,2279691751,2279691671,2279691670,2279691612,2279691611,2279691602,2279691601,2279691432,2279691431,2279691015,2279691014,2279691006,2279691005,2279690092,2279690090,8087817207,8087804238,8087817205,8087817206,8087804219,8087804235,8087804222,8087804225,8087800899,8087800406,8087804216,8087800218,8087817125,8087817126)
   JOIN EDM_VIEWS_PRD.DW_VIEWS.Calendar merge on merge.CALENDAR_DT = A.txn_dte JOIN EDM_SANDBOX_PRD.CORE_TECH.ZHU_COMP_WEEK week on  week.comp_week_id = (merge.FISCAL_YEAR_NBR ||LPAD(merge.Fiscal_Week_Nbr,2,0)) and merge.DW_CURRENT_VERSION_IND =TRUE and MERGE.DW_LOGICAL_DELETE_IND =FALSE  and current_week_id &gt;= 202001 and data_refresh_dt &lt; current_date
   JOIN EDM_VIEWS_PRD.DW_EDW_VIEWS.LIFESTYLE_SAME_STR_DAY same on same.store_id = A.store_id AND  same.txn_dt = A.txn_dte and same_store_ind = 'Y'
   LEFT JOIN (SELECT HOUSEHOLD_ID
                    ,ANNUAL_LEVEL2_SEGMENT_ID
                    ,WEEK_ID
                    ,CASE WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (1) THEN 'ELITE'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (2) THEN 'BEST'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (3, 4) THEN 'GOOD'
                          WHEN ANNUAL_LEVEL2_SEGMENT_ID IN (5, 6) THEN 'OCCASIONAL'
                          ELSE 'UNKNOWN'
                          END AS FACTS_SEG_DESC
              FROM EDM_VIEWS_PRD.DW_EDW_VIEWS.FACTS_SEGMENT_WEEK
              GROUP BY 1, 2, 3, 4
    ) AS FACTS ON FACTS.HOUSEHOLD_ID = F.HOUSEHOLD_ID AND FACTS.WEEK_ID = comp_week_id

      AND A.REV_DTL_SUBTYPE_ID IN (0, 7)
      AND FACTS.ANNUAL_LEVEL2_SEGMENT_ID IN (1,2,3,4)
    GROUP BY 1,2,3,4,5
    ) AS T2
</code></pre>
<p>ON T1.UPC_ID = T2.UPC_ID
AND T1.DIVISION_NM = T2.DIVISION_NM AND T1.WEEK_ID = T2.WEEK_ID) ) TB</p>
<p>GROUP BY 1,2,3,4,5</p>
<div class="highlight"><pre><span></span><code>### ads, page, mods 
```sql
select
PAGE_IMAGE,
WEEK_STARTING,
CHANNEL,
RETAILER,
MARKET,
DEPARTMENT,
CATEGORY,
BRAND,
PRODUCT_SIZE,
OFFER,
OFFER_TYPE,
AD_PRICE,
NET_UNIT_PRICE,
UNIT_PRICE,
MUST_BUY,
MEDIA_TYPE,
PAGE_POSITION,
COUNT(DISTINCT(UNIQUE_AD)) AS AD_COUNT,
UPC as upc_id



from &quot;EDM_VIEWS_PRD&quot;.&quot;DW_BIZOPS_VIEWS&quot;.&quot;ALBERTSONS_PROMO&quot; a
join &quot;EDM_VIEWS_PRD&quot;.&quot;DW_BIZOPS_VIEWS&quot;.&quot;ALBERTSONS_PROMO_UPC&quot; b
on a.top_crop_id = b.top_crop_id



--Where CHANNEL LIKE (&#39;%Supermarkets%&#39;)
--AND WEEK_STARTING &gt; DATE &#39;2022-03-01&#39;
--AND CATEGORY = &#39;Coffee&#39;
--AND BRAND = &#39;Folgers&#39;
--and RETAILER like (&#39;%Ralphs%&#39;)
--and UPC_ID in ()
WHERE WEEK_STARTING BETWEEN (&#39;2022-04-10&#39;) AND (&#39;2023-04-16&#39;)
AND PARENT_RETAILER IN (&#39;Walmart, INC&#39;,&#39;Kroger&#39;,&#39;Albertsons LLC Corp&#39;,&#39;Ahold Delhaize&#39;)
--AND MARKET IN (&#39;Seattle, WA&#39;,&#39;Phoenix, AZ&#39;,&#39;Dallas, TX&#39;,&#39;Los Angeles, CA&#39;,&#39;Denver, CO&#39;,
-- &#39;Boston, MA&#39;,&#39;Portland, OR&#39;,&#39;Chicago, IL&#39;,&#39;Philadelphia, PA&#39;,&#39;Lubbock, TX&#39;,
-- &#39;Boise, ID&#39;,&#39;San Francisco, CA&#39;)
and MARKET IN (&#39;Boise, ID&#39;)
and Retailer in (&#39;Albertsons IM&#39;)
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,19
ORDER BY AD_COUNT DESC
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>